importpathfrom'path'importpuppeteerfrom'puppeteer'exportfunctiongetExampleUrl(name:string,apiType:'classic'|'composition'){constfile=apiType==='composition'?`${name}.html`:`${name}/index.html`return`file://${path.resolve(__dirname,`../../examples/${apiType}/${file}`)}`}exportconstE2E_TIMEOUT=30*1000constpuppeteerOptions=process.env.CI?{args:['--no-sandbox','--disable-setuid-sandbox']}:{headless:!process.env.DEBUG}constmaxTries=30exportconsttimeout=(n:number)=>newPromise(r=>setTimeout(r,n))exportasyncfunctionexpectByPolling(poll:()=>Promise<any>,expected:string){for(lettries=0;tries<maxTries;tries++){constactual=(awaitpoll())||''if(actual.indexOf(expected)>-1||tries===maxTries-1){expect(actual).toMatch(expected)break}else{awaittimeout(50)}}}exportfunctionsetupPuppeteer(){letbrowser:puppeteer.Browserletpage:puppeteer.PagebeforeAll(async()=>{browser=awaitpuppeteer.launch(puppeteerOptions)})beforeEach(async()=>{page=awaitbrowser.newPage()awaitpage.evaluateOnNewDocument(()=>{localStorage.clear()})page.on('console',e=>{if(e.type()==='error'){consterr=e.args()[0]console.error(`ErrorfromPuppeteer-loadedpage:\n`,err._remoteObject.description)}})})afterEach(async()=>{awaitpage.close()})afterAll(async()=>{awaitbrowser.close()})asyncfunctionclick(selector:string,options?:puppeteer.ClickOptions){awaitpage.click(selector,options)}asyncfunctioncount(selector:string){return(awaitpage.$$(selector)).length}asyncfunctiontext(selector:string){returnawaitpage.$eval(selector,node=>node.textContent)}asyncfunctionvalue(selector:string){returnawaitpage.$eval(selector,node=>(nodeasHTMLInputElement).value)}asyncfunctionhtml(selector:string){returnawaitpage.$eval(selector,node=>node.innerHTML)}asyncfunctionclassList(selector:string){returnawaitpage.$eval(selector,(node:any)=>[...node.classList])}asyncfunctionchildrenCount(selector:string){returnawaitpage.$eval(selector,(node:any)=>node.children.length)}asyncfunctionisVisible(selector:string){constdisplay=awaitpage.$eval(selector,node=>{returnwindow.getComputedStyle(node).display})returndisplay!=='none'}asyncfunctionisChecked(selector:string){returnawaitpage.$eval(selector,node=>(nodeasHTMLInputElement).checked)}asyncfunctionisFocused(selector:string){returnawaitpage.$eval(selector,node=>node===document.activeElement)}asyncfunctionsetValue(selector:string,value:string){awaitpage.$eval(selector,(node,value)=>{;(nodeasHTMLInputElement).value=valueasstringnode.dispatchEvent(newEvent('input'))},value)}asyncfunctiontypeValue(selector:string,value:string){constel=(awaitpage.$(selector))!awaitel.evaluate(node=>((nodeasHTMLInputElement).value=''))awaitel.type(value)}asyncfunctionenterValue(selector:string,value:string){constel=(awaitpage.$(selector))!awaitel.evaluate(node=>((nodeasHTMLInputElement).value=''))awaitel.type(value)awaitel.press('Enter')}asyncfunctionclearValue(selector:string){returnawaitpage.$eval(selector,node=>((nodeasHTMLInputElement).value=''))}functiontimeout(time:number){returnpage.evaluate(time=>{returnnewPromise(r=>{setTimeout(r,time)})},time)}functionnextFrame(){returnpage.evaluate(()=>{returnnewPromise(resolve=>{requestAnimationFrame(()=>{requestAnimationFrame(resolve)})})})}return{page:()=>page,click,count,text,value,html,classList,childrenCount,isVisible,isChecked,isFocused,setValue,typeValue,enterValue,clearValue,timeout,nextFrame}}