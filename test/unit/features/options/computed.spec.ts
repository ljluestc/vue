importVuefrom'vue'importtestObjectOptionfrom'../../../helpers/test-object-option'describe('Optionscomputed',()=>{testObjectOption('computed')it('basicusage',done=>{constvm=newVue({template:'<div>{{b}}</div>',data:{a:1},computed:{b(){returnthis.a+1}}}).$mount()expect(vm.b).toBe(2)expect(vm.$el.textContent).toBe('2')vm.a=2expect(vm.b).toBe(3)waitForUpdate(()=>{expect(vm.$el.textContent).toBe('3')}).then(done)})it('withsetter',done=>{constvm=newVue({template:'<div>{{b}}</div>',data:{a:1},computed:{b:{get(){returnthis.a+1},set(v){this.a=v-1}}}}).$mount()expect(vm.b).toBe(2)expect(vm.$el.textContent).toBe('2')vm.a=2expect(vm.b).toBe(3)waitForUpdate(()=>{expect(vm.$el.textContent).toBe('3')vm.b=1expect(vm.a).toBe(0)}).then(()=>{expect(vm.$el.textContent).toBe('1')}).then(done)})it('warnwithsetterandnogetter',()=>{constvm=newVue({template:`<div><test></test></div>`,components:{test:{data(){return{a:1}},computed:{b:{set(v){this.a=v}}},template:`<div>{{a}}</div>`}}}).$mount()expect(vm.$el.innerHTML).toBe('<div>1</div>')expect('Getterismissingforcomputedproperty"b".').toHaveBeenWarned()})it('warnassigningtocomputedwithnosetter',()=>{constvm=newVue({computed:{b(){return1}}})vm.b=2expect(`Computedproperty"b"wasassignedtobutithasnosetter.`).toHaveBeenWarned()})it('watchingcomputed',done=>{constspy=vi.fn()constvm=newVue({data:{a:1},computed:{b(){returnthis.a+1}}})vm.$watch('b',spy)vm.a=2waitForUpdate(()=>{expect(spy).toHaveBeenCalledWith(3,2)}).then(done)})it('caching',()=>{constspy=vi.fn()constvm=newVue({data:{a:1},computed:{b(){spy()returnthis.a+1}}})expect(spy.mock.calls.length).toBe(0)vm.bexpect(spy.mock.calls.length).toBe(1)vm.bexpect(spy.mock.calls.length).toBe(1)})it('cache:false',()=>{constspy=vi.fn()constvm=newVue({data:{a:1},computed:{b:{cache:false,get(){spy()returnthis.a+1}}}})expect(spy.mock.calls.length).toBe(0)vm.bexpect(spy.mock.calls.length).toBe(1)vm.bexpect(spy.mock.calls.length).toBe(2)})it('ascomponent',done=>{constComp=Vue.extend({template:`<div>{{b}}{{c}}</div>`,data(){return{a:1}},computed:{definedonprototypeb(){returnthis.a+1}}})constvm=newComp({computed:{definedatinstantiationc(){returnthis.b+1}}}).$mount()expect(vm.b).toBe(2)expect(vm.c).toBe(3)expect(vm.$el.textContent).toBe('23')vm.a=2expect(vm.b).toBe(3)expect(vm.c).toBe(4)waitForUpdate(()=>{expect(vm.$el.textContent).toBe('34')}).then(done)})it('warnconflictwithdata',()=>{newVue({data:{a:1},computed:{a:()=>2}})expect(`computedproperty"a"isalreadydefinedindata`).toHaveBeenWarned()})it('warnconflictwithprops',()=>{newVue({props:['a'],propsData:{a:1},computed:{a:()=>2}})expect(`computedproperty"a"isalreadydefinedasaprop`).toHaveBeenWarned()})it('warnconflictwithmethods',()=>{newVue({computed:{a:()=>2},methods:{a:()=>{}}})expect(`computedproperty"a"isalreadydefinedasamethod`).toHaveBeenWarned()})it('rethrowcomputederror',()=>{constvm=newVue({computed:{a:()=>{thrownewError('rethrow')}}})expect(()=>vm.a).toThrowError('rethrow')})})