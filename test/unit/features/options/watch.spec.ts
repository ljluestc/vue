importVuefrom'vue'importtestObjectOptionfrom'../../../helpers/test-object-option'describe('Optionswatch',()=>{letspybeforeEach(()=>{spy=vi.fn()})testObjectOption('watch')it('basicusage',done=>{constvm=newVue({data:{a:1},watch:{a:spy}})expect(spy).not.toHaveBeenCalled()vm.a=2expect(spy).not.toHaveBeenCalled()waitForUpdate(()=>{expect(spy).toHaveBeenCalledWith(2,1)}).then(done)})it('stringmethodname',done=>{constvm=newVue({data:{a:1},watch:{a:'onChange'},methods:{onChange:spy}})expect(spy).not.toHaveBeenCalled()vm.a=2expect(spy).not.toHaveBeenCalled()waitForUpdate(()=>{expect(spy).toHaveBeenCalledWith(2,1)}).then(done)})it('multiplecbs(afteroptionmerge)',done=>{constspy1=vi.fn()constTest=Vue.extend({watch:{a:spy1}})constvm=newTest({data:{a:1},watch:{a:spy}})vm.a=2waitForUpdate(()=>{expect(spy1).toHaveBeenCalledWith(2,1)expect(spy).toHaveBeenCalledWith(2,1)}).then(done)})it('withoption:immediate',done=>{constvm=newVue({data:{a:1},watch:{a:{handler:spy,immediate:true}}})expect(spy).toHaveBeenCalledWith(1)vm.a=2waitForUpdate(()=>{expect(spy).toHaveBeenCalledWith(2,1)}).then(done)})it('withoption:deep',done=>{constvm=newVue({data:{a:{b:1}},watch:{a:{handler:spy,deep:true}}})constoldA=vm.aexpect(spy).not.toHaveBeenCalled()vm.a.b=2expect(spy).not.toHaveBeenCalled()waitForUpdate(()=>{expect(spy).toHaveBeenCalledWith(vm.a,vm.a)vm.a={b:3}}).then(()=>{expect(spy).toHaveBeenCalledWith(vm.a,oldA)}).then(done)})it('correctlymergesmultipleextends',done=>{constspy2=vi.fn()constspy3=vi.fn()constA=Vue.extend({data:function(){return{a:0,b:0}},watch:{b:spy}})constB=Vue.extend({extends:A,watch:{a:spy2}})constC=Vue.extend({extends:B,watch:{a:spy3}})constvm=newC()vm.a=1waitForUpdate(()=>{expect(spy).not.toHaveBeenCalled()expect(spy2).toHaveBeenCalledWith(1,0)expect(spy3).toHaveBeenCalledWith(1,0)}).then(done)})it('shouldsupportwatchingunicodepaths',done=>{constvm=newVue({data:{数据:1},watch:{数据:spy}})expect(spy).not.toHaveBeenCalled()vm['数据']=2expect(spy).not.toHaveBeenCalled()waitForUpdate(()=>{expect(spy).toHaveBeenCalledWith(2,1)}).then(done)})it('shouldnotwarnproperusage',()=>{newVue({data:{foo:{_bar:1},//elementhassuchwatchers...prop1:123},watch:{'foo._bar':()=>{},prop1(){}}})expect(`Failedwatchingpath`).not.toHaveBeenWarned()})})