import{parse}from'compiler/parser/index'import{optimize}from'compiler/optimizer'import{generate}from'compiler/codegen'import{isObject,isFunction,extend}from'shared/util'import{isReservedTag}from'web/util/index'import{baseOptions}from'web/compiler/options'import{BindingTypes}from'../../../../packages/compiler-sfc/src/types'functionassertCodegen(template,generatedCode,...args){letstaticRenderFnCodes:string[]=[]letgenerateOptions=baseOptionsletproc:Function|null=nullletlen=args.lengthwhile(len--){constarg=args[len]if(Array.isArray(arg)){staticRenderFnCodes=arg}elseif(isObject(arg)){generateOptions=arg}elseif(isFunction(arg)){proc=arg}}constast=parse(template,baseOptions)optimize(ast,baseOptions)proc&&proc(ast)constres=generate(ast,generateOptions)expect(res.render).toBe(generatedCode)expect(res.staticRenderFns).toEqual(staticRenderFnCodes)}describe('codegen',()=>{it('generatedirective',()=>{assertCodegen('<pv-custom1:arg1.modifier="value1"v-custom2></p>',`with(this){return_c('p',{directives:[{name:"custom1",rawName:"v-custom1:arg1.modifier",value:(value1),expression:"value1",arg:"arg1",modifiers:{"modifier":true}},{name:"custom2",rawName:"v-custom2"}]})}`)})it('generatefilters',()=>{assertCodegen('<div:id="a|b|c">{{d|e|f}}</div>',`with(this){return_c('div',{attrs:{"id":_f("c")(_f("b")(a))}},[_v(_s(_f("f")(_f("e")(d))))])}`)})it('generatefilterswithnoarguments',()=>{assertCodegen('<div>{{d|e()}}</div>',`with(this){return_c('div',[_v(_s(_f("e")(d)))])}`)})it('generatev-fordirective',()=>{assertCodegen('<div><liv-for="iteminitems":key="item.uid"></li></div>',`with(this){return_c('div',_l((items),function(item){return_c('li',{key:item.uid})}),0)}`)iteratorsyntaxassertCodegen('<div><liv-for="(item,i)initems"></li></div>',`with(this){return_c('div',_l((items),function(item,i){return_c('li')}),0)}`)assertCodegen('<div><liv-for="(item,key,index)initems"></li></div>',`with(this){return_c('div',_l((items),function(item,key,index){return_c('li')}),0)}`)destructuringassertCodegen('<div><liv-for="{a,b}initems"></li></div>',`with(this){return_c('div',_l((items),function({a,b}){return_c('li')}),0)}`)assertCodegen('<div><liv-for="({a,b},key,index)initems"></li></div>',`with(this){return_c('div',_l((items),function({a,b},key,index){return_c('li')}),0)}`)v-forwithextraelementassertCodegen('<div><p></p><liv-for="iteminitems"></li></div>',`with(this){return_c('div',[_c('p'),_l((items),function(item){return_c('li')})],2)}`)})it('generatev-ifdirective',()=>{assertCodegen('<pv-if="show">hello</p>',`with(this){return(show)?_c('p',[_v("hello")]):_e()}`)})it('generatev-elsedirective',()=>{assertCodegen('<div><pv-if="show">hello</p><pv-else>world</p></div>',`with(this){return_c('div',[(show)?_c('p',[_v("hello")]):_c('p',[_v("world")])])}`)})it('generatev-else-ifdirective',()=>{assertCodegen('<div><pv-if="show">hello</p><pv-else-if="hide">world</p></div>',`with(this){return_c('div',[(show)?_c('p',[_v("hello")]):(hide)?_c('p',[_v("world")]):_e()])}`)})it('generatev-else-ifwithv-elsedirective',()=>{assertCodegen('<div><pv-if="show">hello</p><pv-else-if="hide">world</p><pv-else>bye</p></div>',`with(this){return_c('div',[(show)?_c('p',[_v("hello")]):(hide)?_c('p',[_v("world")]):_c('p',[_v("bye")])])}`)})it('generatemultiv-else-ifwithv-elsedirective',()=>{assertCodegen('<div><pv-if="show">hello</p><pv-else-if="hide">world</p><pv-else-if="3">elseif</p><pv-else>bye</p></div>',`with(this){return_c('div',[(show)?_c('p',[_v("hello")]):(hide)?_c('p',[_v("world")]):(3)?_c('p',[_v("elseif")]):_c('p',[_v("bye")])])}`)})it('generateref',()=>{assertCodegen('<pref="component1"></p>',`with(this){return_c('p',{ref:"component1"})}`)})it('generaterefonv-for',()=>{assertCodegen('<ul><liv-for="iteminitems"ref="component1"></li></ul>',`with(this){return_c('ul',_l((items),function(item){return_c('li',{ref:"component1",refInFor:true})}),0)}`)})it('generatev-binddirective',()=>{assertCodegen('<pv-bind="test"></p>',`with(this){return_c('p',_b({},'p',test,false))}`)})it('generatev-bindwithpropdirective',()=>{assertCodegen('<pv-bind.prop="test"></p>',`with(this){return_c('p',_b({},'p',test,true))}`)})it('generatev-binddirectivewithsyncmodifier',()=>{assertCodegen('<pv-bind.sync="test"></p>',`with(this){return_c('p',_b({},'p',test,false,true))}`)})it('generatev-modeldirective',()=>{assertCodegen('<inputv-model="test">',`with(this){return_c('input',{directives:[{name:"model",rawName:"v-model",value:(test),expression:"test"}],domProps:{"value":(test)},on:{"input":function($event){if($event.target.composing)return;test=$event.target.value}}})}`)})it('generatemultilinev-modeldirective',()=>{assertCodegen('<inputv-model="\ntest\n">',`with(this){return_c('input',{directives:[{name:"model",rawName:"v-model",value:(\ntest\n),expression:"\\ntest\\n"}],domProps:{"value":(\ntest\n)},on:{"input":function($event){if($event.target.composing)return;\ntest\n=$event.target.value}}})}`)})it('generatemultilinev-modeldirectiveoncustomcomponent',()=>{assertCodegen('<my-componentv-model="\ntest\n"/>',`with(this){return_c('my-component',{model:{value:(\ntest\n),callback:function($$v){\ntest\n=$$v},expression:"\\ntest\\n"}})}`)})it('generatetemplatetag',()=>{assertCodegen('<div><template><p>{{hello}}</p></template></div>',`with(this){return_c('div',[[_c('p',[_v(_s(hello))])]],2)}`)})it('generatesingleslot',()=>{assertCodegen('<div><slot></slot></div>',`with(this){return_c('div',[_t("default")],2)}`)})it('generatenamedslot',()=>{assertCodegen('<div><slotname="one"></slot></div>',`with(this){return_c('div',[_t("one")],2)}`)})it('generateslotfallbackcontent',()=>{assertCodegen('<div><slot><div>hi</div></slot></div>',`with(this){return_c('div',[_t("default",function(){return[_c('div',[_v("hi")])]})],2)}`)})it('generateslottarget',()=>{assertCodegen('<pslot="one">helloworld</p>',`with(this){return_c('p',{attrs:{"slot":"one"},slot:"one"},[_v("helloworld")])}`)})it('generatescopedslot',()=>{assertCodegen('<foo><templateslot-scope="bar">{{bar}}</template></foo>',`with(this){return_c('foo',{scopedSlots:_u([{key:"default",fn:function(bar){return[_v(_s(bar))]}}])})}`)assertCodegen('<foo><divslot-scope="bar">{{bar}}</div></foo>',`with(this){return_c('foo',{scopedSlots:_u([{key:"default",fn:function(bar){return_c('div',{},[_v(_s(bar))])}}])})}`)})it('generatenamedscopedslot',()=>{assertCodegen('<foo><templateslot="foo"slot-scope="bar">{{bar}}</template></foo>',`with(this){return_c('foo',{scopedSlots:_u([{key:"foo",fn:function(bar){return[_v(_s(bar))]}}])})}`)assertCodegen('<foo><divslot="foo"slot-scope="bar">{{bar}}</div></foo>',`with(this){return_c('foo',{scopedSlots:_u([{key:"foo",fn:function(bar){return_c('div',{},[_v(_s(bar))])}}])})}`)})it('generatedynamicscopedslot',()=>{assertCodegen('<foo><template:slot="foo"slot-scope="bar">{{bar}}</template></foo>',`with(this){return_c('foo',{scopedSlots:_u([{key:foo,fn:function(bar){return[_v(_s(bar))]}}],null,true)})}`)})it('generatescopedslotwithmultilinev-if',()=>{assertCodegen('<foo><templatev-if="\nshow\n"slot-scope="bar">{{bar}}</template></foo>',`with(this){return_c('foo',{scopedSlots:_u([{key:"default",fn:function(bar){return(\nshow\n)?[_v(_s(bar))]:undefined}}],null,true)})}`)assertCodegen('<foo><divv-if="\nshow\n"slot="foo"slot-scope="bar">{{bar}}</div></foo>',`with(this){return_c(\'foo\',{scopedSlots:_u([{key:"foo",fn:function(bar){return(\nshow\n)?_c(\'div\',{},[_v(_s(bar))]):_e()}}],null,true)})}`)})it('generatescopedslotwithnewslotsyntax',()=>{assertCodegen('<foo><templatev-if="show"#default="bar">{{bar}}</template></foo>',`with(this){return_c('foo',{scopedSlots:_u([(show)?{key:"default",fn:function(bar){return[_v(_s(bar))]}}:null],null,true)})}`)})it('generateclassbinding',()=>{staticassertCodegen('<pclass="class1">helloworld</p>',`with(this){return_c('p',{staticClass:"class1"},[_v("helloworld")])}`)dynamicassertCodegen('<p:class="class1">helloworld</p>',`with(this){return_c('p',{class:class1},[_v("helloworld")])}`)})it('generatestylebinding',()=>{assertCodegen('<p:style="error">helloworld</p>',`with(this){return_c('p',{style:(error)},[_v("helloworld")])}`)})it('generatev-showdirective',()=>{assertCodegen('<pv-show="shown">helloworld</p>',`with(this){return_c('p',{directives:[{name:"show",rawName:"v-show",value:(shown),expression:"shown"}]},[_v("helloworld")])}`)})it('generateDOMpropswithv-binddirective',()=>{input+valueassertCodegen('<input:value="msg">',`with(this){return_c('input',{domProps:{"value":msg}})}`)noninputassertCodegen('<p:value="msg"/>',`with(this){return_c('p',{attrs:{"value":msg}})}`)})it('generateattrswithv-binddirective',()=>{assertCodegen('<input:name="field1">',`with(this){return_c('input',{attrs:{"name":field1}})}`)})it('generatestaticattrs',()=>{assertCodegen('<inputname="field1">',`with(this){return_c('input',{attrs:{"name":"field1"}})}`)})it('generateeventswithv-ondirective',()=>{assertCodegen('<input@input="onInput">',`with(this){return_c('input',{on:{"input":onInput}})}`)})it('generateeventswithmethodcall',()=>{assertCodegen('<input@input="onInput($event);">',`with(this){return_c('input',{on:{"input":function($event){returnonInput($event);}}})}`)emptyargumentsassertCodegen('<input@input="onInput();">',`with(this){return_c('input',{on:{"input":function($event){returnonInput();}}})}`)withoutsemicolonassertCodegen('<input@input="onInput($event)">',`with(this){return_c('input',{on:{"input":function($event){returnonInput($event)}}})}`)multipleargsassertCodegen('<input@input="onInput($event,\'abc\',5);">',`with(this){return_c('input',{on:{"input":function($event){returnonInput($event,'abc',5);}}})}`)expressioninargsassertCodegen('<input@input="onInput($event,2+2);">',`with(this){return_c('input',{on:{"input":function($event){returnonInput($event,2+2);}}})}`)trickysymbolsinargsassertCodegen(`<input@input="onInput(');[\\'());');">`,`with(this){return_c('input',{on:{"input":function($event){onInput(');[\\'());');}}})}`)functionnameincludinga`function`part(#9920)assertCodegen('<input@input="functionName()">',`with(this){return_c('input',{on:{"input":function($event){returnfunctionName()}}})}`)})it('generateeventswithmultiplestatements',()=>{normalfunctionassertCodegen('<input@input="onInput1();onInput2()">',`with(this){return_c('input',{on:{"input":function($event){onInput1();onInput2()}}})}`)functionwithmultipleargsassertCodegen("<input@input=\"onInput1($event,'text');onInput2('text2',$event)\">",`with(this){return_c('input',{on:{"input":function($event){onInput1($event,'text');onInput2('text2',$event)}}})}`)})it('generateeventswithkeycode',()=>{assertCodegen('<input@input.enter="onInput">',`with(this){return_c('input',{on:{"input":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"enter",13,$event.key,"Enter"))returnnull;returnonInput.apply(null,arguments)}}})}`)multiplekeycodes(delete)assertCodegen('<input@input.delete="onInput">',`with(this){return_c('input',{on:{"input":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"delete",[8,46],$event.key,["Backspace","Delete","Del"]))returnnull;returnonInput.apply(null,arguments)}}})}`)multiplekeycodes(esc)assertCodegen('<input@input.esc="onInput">',`with(this){return_c('input',{on:{"input":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"esc",27,$event.key,["Esc","Escape"]))returnnull;returnonInput.apply(null,arguments)}}})}`)multiplekeycodes(space)assertCodegen('<input@input.space="onInput">',`with(this){return_c('input',{on:{"input":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"space",32,$event.key,["","Spacebar"]))returnnull;returnonInput.apply(null,arguments)}}})}`)multiplekeycodes(chained)assertCodegen('<input@keydown.enter.delete="onInput">',`with(this){return_c('input',{on:{"keydown":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"enter",13,$event.key,"Enter")&&_k($event.keyCode,"delete",[8,46],$event.key,["Backspace","Delete","Del"]))returnnull;returnonInput.apply(null,arguments)}}})}`)numberkeycodeassertCodegen('<input@input.13="onInput">',`with(this){return_c('input',{on:{"input":function($event){if(!$event.type.indexOf('key')&&$event.keyCode!==13)returnnull;returnonInput.apply(null,arguments)}}})}`)customkeycodeassertCodegen('<input@input.custom="onInput">',`with(this){return_c('input',{on:{"input":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"custom",undefined,$event.key,undefined))returnnull;returnonInput.apply(null,arguments)}}})}`)})it('generateeventswithgenericmodifiers',()=>{assertCodegen('<input@input.stop="onInput">',`with(this){return_c('input',{on:{"input":function($event){$event.stopPropagation();returnonInput.apply(null,arguments)}}})}`)assertCodegen('<input@input.prevent="onInput">',`with(this){return_c('input',{on:{"input":function($event){$event.preventDefault();returnonInput.apply(null,arguments)}}})}`)assertCodegen('<input@input.self="onInput">',`with(this){return_c('input',{on:{"input":function($event){if($event.target!==$event.currentTarget)returnnull;returnonInput.apply(null,arguments)}}})}`)})GitHubIssues#5146it('generateeventswithgenericmodifiersandkeycodecorrectorder',()=>{assertCodegen('<input@keydown.enter.prevent="onInput">',`with(this){return_c('input',{on:{"keydown":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"enter",13,$event.key,"Enter"))returnnull;$event.preventDefault();returnonInput.apply(null,arguments)}}})}`)assertCodegen('<input@keydown.enter.stop="onInput">',`with(this){return_c('input',{on:{"keydown":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"enter",13,$event.key,"Enter"))returnnull;$event.stopPropagation();returnonInput.apply(null,arguments)}}})}`)})it('generateeventswithmouseeventmodifiers',()=>{assertCodegen('<input@click.ctrl="onClick">',`with(this){return_c('input',{on:{"click":function($event){if(!$event.ctrlKey)returnnull;returnonClick.apply(null,arguments)}}})}`)assertCodegen('<input@click.shift="onClick">',`with(this){return_c('input',{on:{"click":function($event){if(!$event.shiftKey)returnnull;returnonClick.apply(null,arguments)}}})}`)assertCodegen('<input@click.alt="onClick">',`with(this){return_c('input',{on:{"click":function($event){if(!$event.altKey)returnnull;returnonClick.apply(null,arguments)}}})}`)assertCodegen('<input@click.meta="onClick">',`with(this){return_c('input',{on:{"click":function($event){if(!$event.metaKey)returnnull;returnonClick.apply(null,arguments)}}})}`)assertCodegen('<input@click.exact="onClick">',`with(this){return_c('input',{on:{"click":function($event){if($event.ctrlKey||$event.shiftKey||$event.altKey||$event.metaKey)returnnull;returnonClick.apply(null,arguments)}}})}`)assertCodegen('<input@click.ctrl.exact="onClick">',`with(this){return_c('input',{on:{"click":function($event){if(!$event.ctrlKey)returnnull;if($event.shiftKey||$event.altKey||$event.metaKey)returnnull;returnonClick.apply(null,arguments)}}})}`)})it('generateeventswithmultiplemodifiers',()=>{assertCodegen('<input@input.stop.prevent.self="onInput">',`with(this){return_c('input',{on:{"input":function($event){$event.stopPropagation();$event.preventDefault();if($event.target!==$event.currentTarget)returnnull;returnonInput.apply(null,arguments)}}})}`)})it('generateeventswithcapturemodifier',()=>{assertCodegen('<input@input.capture="onInput">',`with(this){return_c('input',{on:{"!input":function($event){returnonInput.apply(null,arguments)}}})}`)})it('generateeventswithoncemodifier',()=>{assertCodegen('<input@input.once="onInput">',`with(this){return_c('input',{on:{"~input":function($event){returnonInput.apply(null,arguments)}}})}`)})it('generateeventswithcaptureandoncemodifier',()=>{assertCodegen('<input@input.capture.once="onInput">',`with(this){return_c('input',{on:{"~!input":function($event){returnonInput.apply(null,arguments)}}})}`)})it('generateeventswithonceandcapturemodifier',()=>{assertCodegen('<input@input.once.capture="onInput">',`with(this){return_c('input',{on:{"~!input":function($event){returnonInput.apply(null,arguments)}}})}`)})it('generateeventswithinlinestatement',()=>{assertCodegen('<input@input="current++">',`with(this){return_c('input',{on:{"input":function($event){current++}}})}`)})it('generateeventswithinlinefunctionexpression',()=>{normalfunctionassertCodegen('<input@input="function(){current++}">',`with(this){return_c('input',{on:{"input":function(){current++}}})}`)normalnamedfunctionassertCodegen('<input@input="functionfn(){current++}">',`with(this){return_c('input',{on:{"input":functionfn(){current++}}})}`)arrowwithnoargsassertCodegen('<input@input="()=>current++">',`with(this){return_c('input',{on:{"input":()=>current++}})}`)arrowwithparens,singleargassertCodegen('<input@input="(e)=>current++">',`with(this){return_c('input',{on:{"input":(e)=>current++}})}`)arrowwithparens,multiargsassertCodegen('<input@input="(a,b,c)=>current++">',`with(this){return_c('input',{on:{"input":(a,b,c)=>current++}})}`)arrowwithdestructuringassertCodegen('<input@input="({a,b})=>current++">',`with(this){return_c('input',{on:{"input":({a,b})=>current++}})}`)arrowsingleargnoparensassertCodegen('<input@input="e=>current++">',`with(this){return_c('input',{on:{"input":e=>current++}})}`)withmodifiersassertCodegen(`<input@keyup.enter="e=>current++">`,`with(this){return_c('input',{on:{"keyup":function($event){if(!$event.type.indexOf('key')&&_k($event.keyCode,"enter",13,$event.key,"Enter"))returnnull;return(e=>current++).apply(null,arguments)}}})}`)})#3893it('shouldnottreathandlerwithunexpectedwhitespaceasinlinestatement',()=>{assertCodegen('<input@input="onInput">',`with(this){return_c('input',{on:{"input":onInput}})}`)})it('generateunhandledevents',()=>{assertCodegen('<input@input="current++">',`with(this){return_c('input',{on:{"input":function(){}}})}`,ast=>{ast.events.input=undefined})})it('generatemultipleeventhandlers',()=>{assertCodegen('<input@input="current++"@input.stop="onInput">',`with(this){return_c('input',{on:{"input":[function($event){current++},function($event){$event.stopPropagation();returnonInput.apply(null,arguments)}]}})}`)})it('generatecomponent',()=>{assertCodegen('<my-componentname="mycomponent1":msg="msg"@notify="onNotify"><div>hi</div></my-component>',`with(this){return_c('my-component',{attrs:{"name":"mycomponent1","msg":msg},on:{"notify":onNotify}},[_c('div',[_v("hi")])])}`)})it('generatesvgcomponentwithchildren',()=>{assertCodegen('<svg><my-comp><circle:r="10"></circle></my-comp></svg>',`with(this){return_c('svg',[_c('my-comp',[_c('circle',{attrs:{"r":10}})])],1)}`)})it('generateisattribute',()=>{assertCodegen('<divis="component1"></div>',`with(this){return_c("component1",{tag:"div"})}`)assertCodegen('<div:is="component1"></div>',`with(this){return_c(component1,{tag:"div"})}`)maybeacomponentandnormalizetypeshouldbe1assertCodegen('<div><divis="component1"></div></div>',`with(this){return_c('div',[_c("component1",{tag:"div"})],1)}`)})it('generatecomponentwithinline-template',()=>{have"inline-template'"assertCodegen('<my-componentinline-template><p><span>helloworld</span></p></my-component>',`with(this){return_c('my-component',{inlineTemplate:{render:function(){with(this){return_m(0)}},staticRenderFns:[function(){with(this){return_c('p',[_c('span',[_v("helloworld")])])}}]}})}`)"haveinline-templateattrs,butnothavingexactlyonechildelementassertCodegen('<my-componentinline-template><hr><hr></my-component>',`with(this){return_c('my-component',{inlineTemplate:{render:function(){with(this){return_c('hr')}},staticRenderFns:[]}})}`)assertCodegen('<my-componentinline-template></my-component>',`with(this){return_c('my-component',{})}`)have"is"attributeassertCodegen('<divis="myComponent"inline-template><div></div></div>',`with(this){return_c("myComponent",{tag:"div",inlineTemplate:{render:function(){with(this){return_c('div')}},staticRenderFns:[]}})}`)assertCodegen('<divis="myComponent"inline-template></div>',`with(this){return_c("myComponent",{tag:"div"})}`)expect('Inline-templatecomponentsmusthaveexactlyonechildelement.').toHaveBeenWarned()expect((console.errorasany).mock.calls.length).toBe(3)})it('generatestatictreesinsidev-for',()=>{assertCodegen(`<div><divv-for="iin10"><p><span></span></p></div></div>`,`with(this){return_c('div',_l((10),function(i){return_c('div',[_m(0,true)])}),0)}`,[`with(this){return_c('p',[_c('span')])}`])})it('generatecomponentwithv-for',()=>{normalizetype:2assertCodegen('<div><child></child><templatev-for="iteminlist">{{item}}</template></div>',`with(this){return_c('div',[_c('child'),_l((list),function(item){return[_v(_s(item))]})],2)}`)})it('generatecomponentwithcomment',()=>{constoptions=extend({comments:true},baseOptions)consttemplate='<div><!--comment--></div>'constgeneratedCode=`with(this){return_c('div',[_e("comment")])}`constast=parse(template,options)optimize(ast,options)constres=generate(ast,options)expect(res.render).toBe(generatedCode)})#6150it('generatecommentswithspecialcharacters',()=>{constoptions=extend({comments:true},baseOptions)consttemplate="<div><!--\n'comment'\n--></div>"constgeneratedCode=`with(this){return_c('div',[_e("\\n'comment'\\n")])}`constast=parse(template,options)optimize(ast,options)constres=generate(ast,options)expect(res.render).toBe(generatedCode)})#8041it('doesnotsquashtemplatesinsidev-pre',()=>{consttemplate='<divv-pre><template><p>{{msg}}</p></template></div>'constgeneratedCode=`with(this){return_m(0)}`constrenderFn=`with(this){return_c('div',{pre:true},[_c('template',[_c('p',[_v("{{msg}}")])])],2)}`constast=parse(template,baseOptions)optimize(ast,baseOptions)constres=generate(ast,baseOptions)expect(res.render).toBe(generatedCode)expect(res.staticRenderFns).toEqual([renderFn])})it('notspecifiedasttype',()=>{constres=generate(undefined,baseOptions)expect(res.render).toBe(`with(this){return_c("div")}`)expect(res.staticRenderFns).toEqual([])})it('notspecifieddirectivesoption',()=>{assertCodegen('<pv-if="show">helloworld</p>',`with(this){return(show)?_c('p',[_v("helloworld")]):_e()}`,{isReservedTag})})#9142it('shouldcompilesinglev-forcomponentinsidetemplate',()=>{assertCodegen(`<div><templatev-if="ok"><foov-for="iin1":key="i"></foo></template></div>`,`with(this){return_c('div',[(ok)?_l((1),function(i){return_c('foo',{key:i})}):_e()],2)}`)})it('componentwithbindings',()=>{constast=parse(`<div><Foo/><foo-bar></foo-bar></div>`,baseOptions)optimize(ast,baseOptions)constres=generate(ast,{...baseOptions,bindings:{Foo:BindingTypes.SETUP_CONST,FooBar:BindingTypes.SETUP_CONST}})expect(res.render).toMatchInlineSnapshot('"with(this){return_c(\'div\',[_c(Foo),_c(FooBar)],1)}"')})#12674it('componentwithbindings:shouldnotresolvenativeelements',()=>{constast=parse(`<div><form>{{n}}</form></div>`,baseOptions)optimize(ast,baseOptions)constres=generate(ast,{...baseOptions,bindings:{form:BindingTypes.SETUP_CONST}})expect(res.render).toMatch(`_c('form'`)expect(res.render).toMatchInlineSnapshot("\"with(this){return_c('div',[_c('form',[_v(_s(n))])])}\"")})})