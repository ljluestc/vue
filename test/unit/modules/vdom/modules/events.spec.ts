import{patch}from'web/runtime/patch'importVNodefrom'core/vdom/vnode'describe('vdomeventsmodule',()=>{it('shouldattacheventhandlertoelement',()=>{constclick=vi.fn()constvnode=newVNode('a',{on:{click}})constelm=patch(null,vnode)document.body.appendChild(elm)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(1)})it('shouldnotduplicatethesamelistener',()=>{constclick=vi.fn()constvnode1=newVNode('a',{on:{click}})constvnode2=newVNode('a',{on:{click}})constelm=patch(null,vnode1)patch(vnode1,vnode2)document.body.appendChild(elm)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(1)})it('shouldupdatedifferentlistener',()=>{constclick=vi.fn()constclick2=vi.fn()constvnode1=newVNode('a',{on:{click}})constvnode2=newVNode('a',{on:{click:click2}})constelm=patch(null,vnode1)document.body.appendChild(elm)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(1)expect(click2.mock.calls.length).toBe(0)patch(vnode1,vnode2)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(1)expect(click2.mock.calls.length).toBe(1)})it('shouldattachArrayofmultiplehandlers',()=>{constclick=vi.fn()constvnode=newVNode('a',{on:{click:[click,click]}})constelm=patch(null,vnode)document.body.appendChild(elm)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(2)})it('shouldupdateArrayofmultiplehandlers',()=>{constclick=vi.fn()constclick2=vi.fn()constvnode1=newVNode('a',{on:{click:[click,click2]}})constvnode2=newVNode('a',{on:{click:[click]}})constelm=patch(null,vnode1)document.body.appendChild(elm)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(1)expect(click2.mock.calls.length).toBe(1)patch(vnode1,vnode2)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(2)expect(click2.mock.calls.length).toBe(1)})it('shouldremovehandlersthatarenolongerpresent',()=>{constclick=vi.fn()constvnode1=newVNode('a',{on:{click}})constvnode2=newVNode('a',{})constelm=patch(null,vnode1)document.body.appendChild(elm)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(1)patch(vnode1,vnode2)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(1)})it('shouldremoveArrayhandlersthatarenolongerpresent',()=>{constclick=vi.fn()constvnode1=newVNode('a',{on:{click:[click,click]}})constvnode2=newVNode('a',{})constelm=patch(null,vnode1)document.body.appendChild(elm)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(2)patch(vnode1,vnode2)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(2)})#4650it('shouldhandlesingle->arrayorarray->singlehandlerchanges',()=>{constclick=vi.fn()constclick2=vi.fn()constclick3=vi.fn()constvnode0=newVNode('a',{on:{click:click}})constvnode1=newVNode('a',{on:{click:[click,click2]}})constvnode2=newVNode('a',{on:{click:click}})constvnode3=newVNode('a',{on:{click:[click2,click3]}})constelm=patch(null,vnode0)document.body.appendChild(elm)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(1)expect(click2.mock.calls.length).toBe(0)patch(vnode0,vnode1)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(2)expect(click2.mock.calls.length).toBe(1)patch(vnode1,vnode2)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(3)expect(click2.mock.calls.length).toBe(1)patch(vnode2,vnode3)global.triggerEvent(elm,'click')expect(click.mock.calls.length).toBe(3)expect(click2.mock.calls.length).toBe(2)expect(click3.mock.calls.length).toBe(1)})})