importVuefrom'vue'import{injectStyles,waitForUpdate,nextFrame}from'./helpers'describe('Transitionbasic',()=>{const{duration,buffer}=injectStyles()as{duration:numberbuffer:number}constexplicitDuration=duration*2letelbeforeEach(()=>{el=document.createElement('div')document.body.appendChild(el)})it('basictransition',done=>{constvm=newVue({template:'<div><transition><divv-if="ok"class="test">foo</div></transition></div>',data:{ok:true}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('namedtransition',done=>{constvm=newVue({template:'<div><transitionname="test"><divv-if="ok"class="test">foo</div></transition></div>',data:{ok:true}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('customtransitionclasses',done=>{constvm=newVue({template:`<div><transitionenter-class="hello"enter-active-class="hello-active"enter-to-class="hello-to"leave-class="bye"leave-to-class="bye-to"leave-active-class="byebyeactivemore"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testbyebyebyeactivemore')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testbyebyeactivemorebye-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testhellohello-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testhello-activehello-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('dynamictransition',done=>{constvm=newVue({template:`<div><transition:name="trans"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true,trans:'test'}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=truevm.trans='changed'}).then(()=>{expect(vm.$el.children[0].className).toBe('testchanged-enterchanged-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testchanged-enter-activechanged-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('inlinetransitionobject',done=>{constenter=jasmine.createSpy()constleave=jasmine.createSpy()constvm=newVue({render(h){returnh('div',null,[h('transition',{props:{name:'inline',enterClass:'hello',enterToClass:'hello-to',enterActiveClass:'hello-active',leaveClass:'bye',leaveToClass:'bye-to',leaveActiveClass:'byebyeactive'},on:{enter,leave}},this.ok?[h('div',{class:'test'},'foo')]:undefined)])},data:{ok:true}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testbyebyebyeactive')expect(leave).toHaveBeenCalled()}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testbyebyeactivebye-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testhellohello-active')expect(enter).toHaveBeenCalled()}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testhello-activehello-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitionevents',done=>{constonLeaveSpy=jasmine.createSpy()constonEnterSpy=jasmine.createSpy()constbeforeLeaveSpy=jasmine.createSpy()constbeforeEnterSpy=jasmine.createSpy()constafterLeaveSpy=jasmine.createSpy()constafterEnterSpy=jasmine.createSpy()constvm=newVue({template:`<div><transitionname="test"@before-enter="beforeEnter"@enter="enter"@after-enter="afterEnter"@before-leave="beforeLeave"@leave="leave"@after-leave="afterLeave"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true},methods:{beforeLeave:el=>{expect(el).toBe(vm.$el.children[0])expect(el.className).toBe('test')beforeLeaveSpy(el)},leave:el=>onLeaveSpy(el),afterLeave:el=>afterLeaveSpy(el),beforeEnter:el=>{expect(vm.$el.contains(el)).toBe(false)expect(el.className).toBe('test')beforeEnterSpy(el)},enter:el=>{expect(vm.$el.contains(el)).toBe(true)onEnterSpy(el)},afterEnter:el=>afterEnterSpy(el)}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')let_el=vm.$el.children[0]vm.ok=falsewaitForUpdate(()=>{expect(beforeLeaveSpy).toHaveBeenCalledWith(_el)expect(onLeaveSpy).toHaveBeenCalledWith(_el)expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(afterLeaveSpy).not.toHaveBeenCalled()expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(afterLeaveSpy).toHaveBeenCalledWith(_el)expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{_el=vm.$el.children[0]expect(beforeEnterSpy).toHaveBeenCalledWith(_el)expect(onEnterSpy).toHaveBeenCalledWith(_el)expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(afterEnterSpy).not.toHaveBeenCalled()expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(afterEnterSpy).toHaveBeenCalledWith(_el)expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitionevents(v-show)',done=>{constonLeaveSpy=jasmine.createSpy()constonEnterSpy=jasmine.createSpy()constbeforeLeaveSpy=jasmine.createSpy()constbeforeEnterSpy=jasmine.createSpy()constafterLeaveSpy=jasmine.createSpy()constafterEnterSpy=jasmine.createSpy()constvm=newVue({template:`<div><transitionname="test"@before-enter="beforeEnter"@enter="enter"@after-enter="afterEnter"@before-leave="beforeLeave"@leave="leave"@after-leave="afterLeave"><divv-show="ok"class="test">foo</div></transition></div>`,data:{ok:true},methods:{beforeLeave:el=>{expect(el.style.display).toBe('')expect(el).toBe(vm.$el.children[0])expect(el.className).toBe('test')beforeLeaveSpy(el)},leave:el=>{expect(el.style.display).toBe('')onLeaveSpy(el)},afterLeave:el=>{expect(el.style.display).toBe('none')afterLeaveSpy(el)},beforeEnter:el=>{expect(el.className).toBe('test')expect(el.style.display).toBe('none')beforeEnterSpy(el)},enter:el=>{expect(el.style.display).toBe('')onEnterSpy(el)},afterEnter:el=>{expect(el.style.display).toBe('')afterEnterSpy(el)}}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')let_el=vm.$el.children[0]vm.ok=falsewaitForUpdate(()=>{expect(beforeLeaveSpy).toHaveBeenCalledWith(_el)expect(onLeaveSpy).toHaveBeenCalledWith(_el)expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(afterLeaveSpy).not.toHaveBeenCalled()expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(afterLeaveSpy).toHaveBeenCalledWith(_el)expect(vm.$el.children[0].style.display).toBe('none')vm.ok=true}).then(()=>{_el=vm.$el.children[0]expect(beforeEnterSpy).toHaveBeenCalledWith(_el)expect(onEnterSpy).toHaveBeenCalledWith(_el)expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(afterEnterSpy).not.toHaveBeenCalled()expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(afterEnterSpy).toHaveBeenCalledWith(_el)expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('explicitusercallbackinJavaScripthooks',done=>{letnextconstvm=newVue({template:`<div><transitionname="test"@enter="enter"@leave="leave"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true},methods:{enter:(el,cb)=>{next=cb},leave:(el,cb)=>{next=cb}}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')expect(next).toBeTruthy()next()expect(vm.$el.children.length).toBe(0)}).then(()=>{vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')expect(next).toBeTruthy()next()expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('css:false',done=>{constenterSpy=jasmine.createSpy()constleaveSpy=jasmine.createSpy()constvm=newVue({template:`<div><transition:css="false"name="test"@enter="enter"@leave="leave"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true},methods:{enter:enterSpy,leave:leaveSpy}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(leaveSpy).toHaveBeenCalled()expect(vm.$el.innerHTML).toBe('<!---->')vm.ok=true}).then(()=>{expect(enterSpy).toHaveBeenCalled()expect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')}).then(done)})it('notransitiondetected',done=>{constenterSpy=jasmine.createSpy()constleaveSpy=jasmine.createSpy()constvm=newVue({template:'<div><transitionname="nope"@enter="enter"@leave="leave"><divv-if="ok">foo</div></transition></div>',data:{ok:true},methods:{enter:enterSpy,leave:leaveSpy}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(leaveSpy).toHaveBeenCalled()expect(vm.$el.innerHTML).toBe('<divclass="nope-leavenope-leave-active">foo</div><!---->')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.innerHTML).toBe('<!---->')vm.ok=true}).then(()=>{expect(enterSpy).toHaveBeenCalled()expect(vm.$el.innerHTML).toBe('<divclass="nope-enternope-enter-active">foo</div>')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.innerHTML).toBe('<div>foo</div>')}).then(done)})it('enterCancelled',done=>{constspy=jasmine.createSpy()constvm=newVue({template:`<div><transitionname="test"@enter-cancelled="enterCancelled"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:false},methods:{enterCancelled:spy}}).$mount(el)expect(vm.$el.innerHTML).toBe('<!---->')vm.ok=truewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration/2).then(()=>{vm.ok=false}).then(()=>{expect(spy).toHaveBeenCalled()expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)}).then(done)})it('shouldremovestaleleavingelements',done=>{constspy=jasmine.createSpy()constvm=newVue({template:`<div><transitionname="test"@after-leave="afterLeave"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true},methods:{afterLeave:spy}}).$mount(el)expect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(duration/2).then(()=>{vm.ok=true}).then(()=>{expect(spy).toHaveBeenCalled()expect(vm.$el.children.length).toBe(1)shouldhaveremovedleavingelementexpect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')}).then(done)})it('transitionwithv-show',done=>{constvm=newVue({template:`<div><transitionname="test"><divv-show="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.textContent).toBe('foo')expect(vm.$el.children[0].style.display).toBe('')expect(vm.$el.children[0].className).toBe('test')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].style.display).toBe('none')vm.ok=true}).then(()=>{expect(vm.$el.children[0].style.display).toBe('')expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitionwithv-show,insidechildcomponent',done=>{constvm=newVue({template:`<div><testv-show="ok"></test></div>`,data:{ok:true},components:{test:{template:`<transitionname="test"><divclass="test">foo</div></transition>`}}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.textContent).toBe('foo')expect(vm.$el.children[0].style.display).toBe('')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].style.display).toBe('none')vm.ok=true}).then(()=>{expect(vm.$el.children[0].style.display).toBe('')expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('leaveCancelled(v-showonly)',done=>{constspy=jasmine.createSpy()constvm=newVue({template:`<div><transitionname="test"@leave-cancelled="leaveCancelled"><divv-show="ok"class="test">foo</div></transition></div>`,data:{ok:true},methods:{leaveCancelled:spy}}).$mount(el)expect(vm.$el.children[0].style.display).toBe('')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(10).then(()=>{vm.ok=true}).then(()=>{expect(spy).toHaveBeenCalled()expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].style.display).toBe('')}).then(done)})it('leavetransitionwithv-show:cancelledonnextframe',done=>{constvm=newVue({template:`<div><transitionname="test"><divv-show="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{vm.ok=true}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('entertransitionwithv-show:cancelledonnextframe',done=>{constvm=newVue({template:`<div><transitionname="test"><divv-show="ok"class="test">foo</div></transition></div>`,data:{ok:false}}).$mount(el)vm.ok=truewaitForUpdate(()=>{vm.ok=false}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('animations',done=>{constvm=newVue({template:`<div><transitionname="test-anim"><divv-if="ok">foo</div></transition></div>`,data:{ok:true}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<div>foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('test-anim-leavetest-anim-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('test-anim-leave-activetest-anim-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('test-anim-entertest-anim-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('test-anim-enter-activetest-anim-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('')}).then(done)})it('explicittransitiontype',done=>{constvm=newVue({template:`<div><transitionname="test-anim-long"type="animation"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-anim-long-leavetest-anim-long-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-anim-long-leave-activetest-anim-long-leave-to')}).thenWaitFor(duration+5).then(()=>{shouldnotendearlyduetotransitionpresenceexpect(vm.$el.children[0].className).toBe('testtest-anim-long-leave-activetest-anim-long-leave-to')}).thenWaitFor(duration+5).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-anim-long-entertest-anim-long-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-anim-long-enter-activetest-anim-long-enter-to')}).thenWaitFor(duration+5).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-anim-long-enter-activetest-anim-long-enter-to')}).thenWaitFor(duration+5).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitiononappear',done=>{constvm=newVue({template:`<div><transitionname="test"appearappear-class="test-appear"appear-to-class="test-appear-to"appear-active-class="test-appear-active"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)waitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-appeartest-appear-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-appear-activetest-appear-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitiononappearwithv-show',done=>{constvm=newVue({template:`<div><transitionname="test"appear><divv-show="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)waitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitiononSVGelements',done=>{constvm=newVue({template:`<svg><transition><circlecx="0"cy="0"r="10"v-if="ok"class="test"></circle></transition></svg>`,data:{ok:true}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.childNodes[0].getAttribute('class')).toBe('test')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.childNodes[0].getAttribute('class')).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.childNodes[0].getAttribute('class')).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.childNodes.length).toBe(1)expect(vm.$el.childNodes[0].nodeType).toBe(8)shouldbeanemptycommentnodeexpect(vm.$el.childNodes[0].textContent).toBe('')vm.ok=true}).then(()=>{expect(vm.$el.childNodes[0].getAttribute('class')).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.childNodes[0].getAttribute('class')).toBe('testv-enter-activev-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.childNodes[0].getAttribute('class')).toBe('test')}).then(done)})it('transitiononchildcomponents',done=>{constvm=newVue({template:`<div><transition><testv-if="ok"class="test"></test></transition></div>`,data:{ok:true},components:{test:{template:`<transitionname="test"><div>foo</div></transition>`testtransitionoverridefromparent}}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitioninsidechildcomponentwithv-if',done=>{constvm=newVue({template:`<div><testv-if="ok"class="test"></test></div>`,data:{ok:true},components:{test:{template:`<transition><div>foo</div></transition>`}}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitionwithappearinsidechildcomponentwithv-if',done=>{constvm=newVue({template:`<div><testv-if="ok"class="test"></test></div>`,data:{ok:true},components:{test:{template:`<transitionappearappear-class="test-appear"appear-to-class="test-appear-to"appear-active-class="test-appear-active"><div>foo</div></transition>`}}}).$mount(el)waitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-appeartest-appear-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-appear-activetest-appear-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')vm.ok=false}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)}).then(done)})it('transitioninsidenestedchildcomponentwithv-if',done=>{constvm=newVue({template:`<div><foov-if="ok"class="test"></foo></div>`,data:{ok:true},components:{foo:{template:'<bar></bar>',components:{bar:{template:'<transition><div>foo</div></transition>'}}}}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('transitionwithappearinsidenestedchildcomponentwithv-if',done=>{constvm=newVue({template:`<div><foov-if="ok"class="test"></foo></div>`,data:{ok:true},components:{foo:{template:'<bar></bar>',components:{bar:{template:`<transitionappearappear-class="test-appear"appear-to-class="test-appear-to"appear-active-class="test-appear-active"><div>foo</div></transition>`}}}}}).$mount(el)waitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-appeartest-appear-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-appear-activetest-appear-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')vm.ok=false}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)}).then(done)})it('customtransitionhigher-ordercomponent',done=>{constvm=newVue({template:'<div><my-transition><divv-if="ok"class="test">foo</div></my-transition></div>',data:{ok:true},components:{'my-transition':{functional:true,render(h,{data,children}){;(data.props||(data.props={})).name='test'returnh('transition',data,children)}}}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<divclass="test">foo</div>')vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testtest-leavetest-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-leave-activetest-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-entertest-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testtest-enter-activetest-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('warnwhenusedonmultipleelements',()=>{newVue({template:`<transition><p>1</p><p>2</p></transition>`}).$mount()expect(`<transition>canonlybeusedonasingleelement`).toHaveBeenWarned()})describe('explicitdurations-',()=>{it('singlevalue',done=>{constvm=newVue({template:`<div><transitionduration="${explicitDuration}"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(explicitDuration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(explicitDuration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('enterandautoleave',done=>{constvm=newVue({template:`<div><transition:duration="{enter:${explicitDuration}}"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(explicitDuration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('leaveandautoenter',done=>{constvm=newVue({template:`<div><transition:duration="{leave:${explicitDuration}}"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(explicitDuration+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('separateenterandleave',done=>{constenter=explicitDurationconstleave=explicitDuration*2constvm=newVue({template:`<div><transition:duration="{enter:${enter},leave:${leave}}"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(leave+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(enter+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)})it('enterandleave+durationchange',done=>{constenter1=explicitDuration*2constenter2=explicitDurationconstleave1=explicitDuration*0.5constleave2=explicitDuration*3constvm=newVue({template:`<div><transition:duration="{enter:enter,leave:leave}"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true,enter:enter1,leave:leave1}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(leave1+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(enter1+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')vm.enter=enter2vm.leave=leave2}).then(()=>{vm.ok=false}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leavev-leave-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(leave2+buffer).then(()=>{expect(vm.$el.children.length).toBe(0)vm.ok=true}).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enterv-enter-active')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(enter2+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')}).then(done)},10000)it('warninvaliddurations',done=>{constvm=newVue({template:`<div><transition:duration="{enter:NaN,leave:'foo'}"><divv-if="ok"class="test">foo</div></transition></div>`,data:{ok:true}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(`<transition>explicitleavedurationisnotavalidnumber-got"foo"`).toHaveBeenWarned()}).thenWaitFor(duration+buffer).then(()=>{vm.ok=true}).then(()=>{expect(`<transition>explicitenterdurationisNaN`).toHaveBeenWarned()}).then(done)})})#6687it('transitiononchildcomponentswithemptyrootnode',done=>{constvm=newVue({template:`<div><transitionmode="out-in"><componentclass="test":is="view"></component></transition></div>`,data:{view:'one'},components:{one:{template:'<divv-if="false">one</div>'},two:{template:'<div>two</div>'}}}).$mount(el)shouldnotapplytransitiononinitialrenderbydefaultexpect(vm.$el.innerHTML).toBe('<!---->')vm.view='two'waitForUpdate(()=>{expect(vm.$el.innerHTML).toBe('<divclass="testv-enterv-enter-active">two</div>')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-enter-activev-enter-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.children[0].className).toBe('test')vm.view='one'}).then(()=>{incomingcommentnodeisappendedinstantlybecauseitdoesn'thavedataandthereforedoesn'tgothroughthetransitionmodule.expect(vm.$el.innerHTML).toBe('<divclass="testv-leavev-leave-active">two</div><!---->')}).thenWaitFor(nextFrame).then(()=>{expect(vm.$el.children[0].className).toBe('testv-leave-activev-leave-to')}).thenWaitFor(duration+buffer).then(()=>{expect(vm.$el.innerHTML).toBe('<!---->')}).then(done)})#8199it('shouldnotthrowerrorwhenreplacedbyv-htmlcontents',done=>{constvm=newVue({template:`<div><divv-if="ok":class="ok"><transition><span>a</span></transition></div><divv-elsev-html="ok"></div></div>`,data:{ok:true}}).$mount(el)vm.ok=falsewaitForUpdate(()=>{expect(vm.$el.children[0].innerHTML).toBe('false')}).then(done)})})