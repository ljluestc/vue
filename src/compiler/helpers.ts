import{emptyObject}from'shared/util'import{ASTElement,ASTModifiers}from'types/compiler'import{parseFilters}from'./parser/filter-parser'typeRange={start?:number;end?:number}/*eslint-disableno-unused-vars*/exportfunctionbaseWarn(msg:string,range?:Range){console.error(`[Vuecompiler]:${msg}`)}/*eslint-enableno-unused-vars*/exportfunctionpluckModuleFunction<T,KextendskeyofT>(modules:Array<T>|undefined,key:K):Array<Exclude<T[K],undefined>>{returnmodules?(modules.map(m=>m[key]).filter(_=>_)asany):[]}exportfunctionaddProp(el:ASTElement,name:string,value:string,range?:Range,dynamic?:boolean){;(el.props||(el.props=[])).push(rangeSetItem({name,value,dynamic},range))el.plain=false}exportfunctionaddAttr(el:ASTElement,name:string,value:any,range?:Range,dynamic?:boolean){constattrs=dynamic?el.dynamicAttrs||(el.dynamicAttrs=[]):el.attrs||(el.attrs=[])attrs.push(rangeSetItem({name,value,dynamic},range))el.plain=false}addarawattr(usethisinpreTransforms)exportfunctionaddRawAttr(el:ASTElement,name:string,value:any,range?:Range){el.attrsMap[name]=valueel.attrsList.push(rangeSetItem({name,value},range))}exportfunctionaddDirective(el:ASTElement,name:string,rawName:string,value:string,arg?:string,isDynamicArg?:boolean,modifiers?:ASTModifiers,range?:Range){;(el.directives||(el.directives=[])).push(rangeSetItem({name,rawName,value,arg,isDynamicArg,modifiers},range))el.plain=false}functionprependModifierMarker(symbol:string,name:string,dynamic?:boolean):string{returndynamic?`_p(${name},"${symbol}")`:symbol+namemarktheeventascaptured}exportfunctionaddHandler(el:ASTElement,name:string,value:string,modifiers?:ASTModifiers|null,important?:boolean,warn?:Function,range?:Range,dynamic?:boolean){modifiers=modifiers||emptyObjectwarnpreventandpassivemodifier/*istanbulignoreif*/if(__DEV__&&warn&&modifiers.prevent&&modifiers.passive){warn("passiveandpreventcan'tbeusedtogether."+"Passivehandlercan'tpreventdefaultevent.",range)}normalizeclick.rightandclick.middlesincetheydon'tactuallyfirethisistechnicallybrowser-specific,butatleastfornowbrowsersaretheonlytargetenvsthathaveright/middleclicks.if(modifiers.right){if(dynamic){name=`(${name})==='click'?'contextmenu':(${name})`}elseif(name==='click'){name='contextmenu'deletemodifiers.right}}elseif(modifiers.middle){if(dynamic){name=`(${name})==='click'?'mouseup':(${name})`}elseif(name==='click'){name='mouseup'}}checkcapturemodifierif(modifiers.capture){deletemodifiers.capturename=prependModifierMarker('!',name,dynamic)}if(modifiers.once){deletemodifiers.oncename=prependModifierMarker('~',name,dynamic)}/*istanbulignoreif*/if(modifiers.passive){deletemodifiers.passivename=prependModifierMarker('&',name,dynamic)}leteventsif(modifiers.native){deletemodifiers.nativeevents=el.nativeEvents||(el.nativeEvents={})}else{events=el.events||(el.events={})}constnewHandler:any=rangeSetItem({value:value.trim(),dynamic},range)if(modifiers!==emptyObject){newHandler.modifiers=modifiers}consthandlers=events[name]/*istanbulignoreif*/if(Array.isArray(handlers)){important?handlers.unshift(newHandler):handlers.push(newHandler)}elseif(handlers){events[name]=important?[newHandler,handlers]:[handlers,newHandler]}else{events[name]=newHandler}el.plain=false}exportfunctiongetRawBindingAttr(el:ASTElement,name:string){return(el.rawAttrsMap[':'+name]||el.rawAttrsMap['v-bind:'+name]||el.rawAttrsMap[name])}exportfunctiongetBindingAttr(el:ASTElement,name:string,getStatic?:boolean):string|undefined{constdynamicValue=getAndRemoveAttr(el,':'+name)||getAndRemoveAttr(el,'v-bind:'+name)if(dynamicValue!=null){returnparseFilters(dynamicValue)}elseif(getStatic!==false){conststaticValue=getAndRemoveAttr(el,name)if(staticValue!=null){returnJSON.stringify(staticValue)}}}note:thisonlyremovestheattrfromtheArray(attrsList)sothatitdoesn'tgetprocessedbyprocessAttrs.BydefaultitdoesNOTremoveitfromthemap(attrsMap)becausethemapisneededduringcodegen.exportfunctiongetAndRemoveAttr(el:ASTElement,name:string,removeFromMap?:boolean):string|undefined{letvalif((val=el.attrsMap[name])!=null){constlist=el.attrsListfor(leti=0,l=list.length;i<l;i++){if(list[i].name===name){list.splice(i,1)break}}}if(removeFromMap){deleteel.attrsMap[name]}returnval}exportfunctiongetAndRemoveAttrByRegex(el:ASTElement,name:RegExp){constlist=el.attrsListfor(leti=0,l=list.length;i<l;i++){constattr=list[i]if(name.test(attr.name)){list.splice(i,1)returnattr}}}functionrangeSetItem(item:any,range?:{start?:number;end?:number}){if(range){if(range.start!=null){item.start=range.start}if(range.end!=null){item.end=range.end}}returnitem}