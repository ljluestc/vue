/***Nottypecheckingthisfilebecauseflowdoesn'tlikeattaching*propertiestoElements.*/import{isTextInputType}from'web/util/element'import{looseEqual,looseIndexOf}from'shared/util'import{mergeVNodeHook}from'core/vdom/helpers/index'import{warn,isIE9,isIE,isEdge}from'core/util/index'/*istanbulignoreif*/if(isIE9){http:www.matts411.com/post/internet-explorer-9-oninput/document.addEventListener('selectionchange',()=>{constel=document.activeElement@ts-expect-errorif(el&&el.vmodel){trigger(el,'input')}})}constdirective={inserted(el,binding,vnode,oldVnode){if(vnode.tag==='select'){#6903if(oldVnode.elm&&!oldVnode.elm._vOptions){mergeVNodeHook(vnode,'postpatch',()=>{directive.componentUpdated(el,binding,vnode)})}else{setSelected(el,binding,vnode.context)}el._vOptions=[].map.call(el.options,getValue)}elseif(vnode.tag==='textarea'||isTextInputType(el.type)){el._vModifiers=binding.modifiersif(!binding.modifiers.lazy){el.addEventListener('compositionstart',onCompositionStart)el.addEventListener('compositionend',onCompositionEnd)Safari<10.2&UIWebViewdoesn'tfirecompositionendwhenswitchingfocusbeforeconfirmingcompositionchoicethisalsofixestheissuewheresomebrowserse.g.iOSChromefires"change"insteadof"input"onautocomplete.el.addEventListener('change',onCompositionEnd)/*istanbulignoreif*/if(isIE9){el.vmodel=true}}}},componentUpdated(el,binding,vnode){if(vnode.tag==='select'){setSelected(el,binding,vnode.context)incasetheoptionsrenderedbyv-forhavechanged,it'spossiblethatthevalueisout-of-syncwiththerenderedoptions.detectsuchcasesandfilteroutvaluesthatnolongerhasamatchingoptionintheDOM.constprevOptions=el._vOptionsconstcurOptions=(el._vOptions=[].map.call(el.options,getValue))if(curOptions.some((o,i)=>!looseEqual(o,prevOptions[i]))){triggerchangeeventifnomatchingoptionfoundforatleastonevalueconstneedReset=el.multiple?binding.value.some(v=>hasNoMatchingOption(v,curOptions)):binding.value!==binding.oldValue&&hasNoMatchingOption(binding.value,curOptions)if(needReset){trigger(el,'change')}}}}}functionsetSelected(el,binding,vm){actuallySetSelected(el,binding,vm)/*istanbulignoreif*/if(isIE||isEdge){setTimeout(()=>{actuallySetSelected(el,binding,vm)},0)}}functionactuallySetSelected(el,binding,vm){constvalue=binding.valueconstisMultiple=el.multipleif(isMultiple&&!Array.isArray(value)){__DEV__&&warn(`<selectmultiplev-model="${binding.expression}">`+`expectsanArrayvalueforitsbinding,butgot${Object.prototype.toString.call(value).slice(8,-1)}`,vm)return}letselected,optionfor(leti=0,l=el.options.length;i<l;i++){option=el.options[i]if(isMultiple){selected=looseIndexOf(value,getValue(option))>-1if(option.selected!==selected){option.selected=selected}}else{if(looseEqual(getValue(option),value)){if(el.selectedIndex!==i){el.selectedIndex=i}return}}}if(!isMultiple){el.selectedIndex=-1}}functionhasNoMatchingOption(value,options){returnoptions.every(o=>!looseEqual(o,value))}functiongetValue(option){return'_value'inoption?option._value:option.value}functiononCompositionStart(e){e.target.composing=true}functiononCompositionEnd(e){preventtriggeringaninputeventfornoreasonif(!e.target.composing)returne.target.composing=falsetrigger(e.target,'input')}functiontrigger(el,type){conste=document.createEvent('HTMLEvents')e.initEvent(type,true,true)el.dispatchEvent(e)}exportdefaultdirective