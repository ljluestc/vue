import{inBrowser,isIE9}from'core/util/index'import{addClass,removeClass}from'web/runtime/class-util'import{remove,extend,cached}from'shared/util'exportfunctionresolveTransition(def?:string|Record<string,any>):Record<string,any>|undefined{if(!def){return}/*istanbulignoreelse*/if(typeofdef==='object'){constres={}if(def.css!==false){extend(res,autoCssTransition(def.name||'v'))}extend(res,def)returnres}elseif(typeofdef==='string'){returnautoCssTransition(def)}}constautoCssTransition:(name:string)=>Object=cached(name=>{return{enterClass:`${name}-enter`,enterToClass:`${name}-enter-to`,enterActiveClass:`${name}-enter-active`,leaveClass:`${name}-leave`,leaveToClass:`${name}-leave-to`,leaveActiveClass:`${name}-leave-active`}})exportconsthasTransition=inBrowser&&!isIE9constTRANSITION='transition'constANIMATION='animation'//Transitionproperty/eventsniffingexportlettransitionProp='transition'exportlettransitionEndEvent='transitionend'exportletanimationProp='animation'exportletanimationEndEvent='animationend'if(hasTransition){/*istanbulignoreif*/if(window.ontransitionend===undefined&&window.onwebkittransitionend!==undefined){transitionProp='WebkitTransition'transitionEndEvent='webkitTransitionEnd'}if(window.onanimationend===undefined&&window.onwebkitanimationend!==undefined){animationProp='WebkitAnimation'animationEndEvent='webkitAnimationEnd'}}//bindingtowindowisnecessarytomakehotreloadworkinIEinstrictmodeconstraf=inBrowser?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:/*istanbulignorenext*/fn=>fn()exportfunctionnextFrame(fn:Function){raf(()=>{//@ts-expect-errorraf(fn)})}exportfunctionaddTransitionClass(el:any,cls:string){consttransitionClasses=el._transitionClasses||(el._transitionClasses=[])if(transitionClasses.indexOf(cls)<0){transitionClasses.push(cls)addClass(el,cls)}}exportfunctionremoveTransitionClass(el:any,cls:string){if(el._transitionClasses){remove(el._transitionClasses,cls)}removeClass(el,cls)}exportfunctionwhenTransitionEnds(el:Element,expectedType:string|undefined,cb:Function){const{type,timeout,propCount}=getTransitionInfo(el,expectedType)if(!type)returncb()constevent:string=type===TRANSITION?transitionEndEvent:animationEndEventletended=0constend=()=>{el.removeEventListener(event,onEnd)cb()}constonEnd=e=>{if(e.target===el){if(++ended>=propCount){end()}}}setTimeout(()=>{if(ended<propCount){end()}},timeout+1)el.addEventListener(event,onEnd)}consttransformRE=/\b(transform|all)(,|$)/exportfunctiongetTransitionInfo(el:Element,expectedType?:string):{type?:string|nullpropCount:numbertimeout:numberhasTransform:boolean}{conststyles:any=window.getComputedStyle(el)//JSDOMmayreturnundefinedfortransitionpropertiesconsttransitionDelays:Array<string>=(styles[transitionProp+'Delay']||'').split(',')consttransitionDurations:Array<string>=(styles[transitionProp+'Duration']||'').split(',')consttransitionTimeout:number=getTimeout(transitionDelays,transitionDurations)constanimationDelays:Array<string>=(styles[animationProp+'Delay']||'').split(',')constanimationDurations:Array<string>=(styles[animationProp+'Duration']||'').split(',')constanimationTimeout:number=getTimeout(animationDelays,animationDurations)lettype:string|undefined|nulllettimeout=0letpropCount=0/*istanbulignoreif*/if(expectedType===TRANSITION){if(transitionTimeout>0){type=TRANSITIONtimeout=transitionTimeoutpropCount=transitionDurations.length}}elseif(expectedType===ANIMATION){if(animationTimeout>0){type=ANIMATIONtimeout=animationTimeoutpropCount=animationDurations.length}}else{timeout=Math.max(transitionTimeout,animationTimeout)type=timeout>0?transitionTimeout>animationTimeout?TRANSITION:ANIMATION:nullpropCount=type?type===TRANSITION?transitionDurations.length:animationDurations.length:0}consthasTransform:boolean=type===TRANSITION&&transformRE.test(styles[transitionProp+'Property'])return{type,timeout,propCount,hasTransform}}functiongetTimeout(delays:Array<string>,durations:Array<string>):number{/*istanbulignorenext*/while(delays.length<durations.length){delays=delays.concat(delays)}returnMath.max.apply(null,durations.map((d,i)=>{returntoMs(d)+toMs(delays[i])}))}//OldversionsofChromium(below61.0.3163.100)formatsfloatingpointernumbers//inalocale-dependentway,usingacommainsteadofadot.//Ifcommaisnotreplacedwithadot,theinputwillberoundeddown(i.e.acting//asafloorfunction)causingunexpectedbehaviorsfunctiontoMs(s:string):number{returnNumber(s.slice(0,-1).replace(',','.'))*1000}