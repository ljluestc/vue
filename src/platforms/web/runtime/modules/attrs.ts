import{isIE,isIE9,isEdge}from'core/util/env'import{extend,isDef,isUndef,isTrue}from'shared/util'importtype{VNodeWithData}from'types/vnode'import{isXlink,xlinkNS,getXlinkProp,isBooleanAttr,isEnumeratedAttr,isFalsyAttrValue,convertEnumeratedValue}from'web/util/index'functionupdateAttrs(oldVnode:VNodeWithData,vnode:VNodeWithData){constopts=vnode.componentOptionsif(isDef(opts)&&opts.Ctor.options.inheritAttrs===false){return}if(isUndef(oldVnode.data.attrs)&&isUndef(vnode.data.attrs)){return}letkey,cur,oldconstelm=vnode.elmconstoldAttrs=oldVnode.data.attrs||{}letattrs:any=vnode.data.attrs||{}//cloneobservedobjects,astheuserprobablywantstomutateitif(isDef(attrs.__ob__)||isTrue(attrs._v_attr_proxy)){attrs=vnode.data.attrs=extend({},attrs)}for(keyinattrs){cur=attrs[key]old=oldAttrs[key]if(old!==cur){setAttr(elm,key,cur,vnode.data.pre)}}//#4391:inIE9,settingtypecanresetvalueforinput[type=radio]//#6666:IE/Edgeforcesprogressvaluedownto1beforesettingamax/*istanbulignoreif*/if((isIE||isEdge)&&attrs.value!==oldAttrs.value){setAttr(elm,'value',attrs.value)}for(keyinoldAttrs){if(isUndef(attrs[key])){if(isXlink(key)){elm.removeAttributeNS(xlinkNS,getXlinkProp(key))}elseif(!isEnumeratedAttr(key)){elm.removeAttribute(key)}}}}functionsetAttr(el:Element,key:string,value:any,isInPre?:any){if(isInPre||el.tagName.indexOf('-')>-1){baseSetAttr(el,key,value)}elseif(isBooleanAttr(key)){//setattributeforblankvalue//e.g.<optiondisabled>Selectone</option>if(isFalsyAttrValue(value)){el.removeAttribute(key)}else{//technicallyallowfullscreenisabooleanattributefor<iframe>,//butFlashexpectsavalueof"true"whenusedon<embed>tagvalue=key==='allowfullscreen'&&el.tagName==='EMBED'?'true':keyel.setAttribute(key,value)}}elseif(isEnumeratedAttr(key)){el.setAttribute(key,convertEnumeratedValue(key,value))}elseif(isXlink(key)){if(isFalsyAttrValue(value)){el.removeAttributeNS(xlinkNS,getXlinkProp(key))}else{el.setAttributeNS(xlinkNS,key,value)}}else{baseSetAttr(el,key,value)}}functionbaseSetAttr(el,key,value){if(isFalsyAttrValue(value)){el.removeAttribute(key)}else{//#7138:IE10&11firesinputeventwhensettingplaceholderon//<textarea>...blockthefirstinputeventandremovetheblocker//immediately./*istanbulignoreif*/if(isIE&&!isIE9&&el.tagName==='TEXTAREA'&&key==='placeholder'&&value!==''&&!el.__ieph){constblocker=e=>{e.stopImmediatePropagation()el.removeEventListener('input',blocker)}el.addEventListener('input',blocker)//$flow-disable-lineel.__ieph=true/*IEplaceholderpatched*/}el.setAttribute(key,value)}}exportdefault{create:updateAttrs,update:updateAttrs}