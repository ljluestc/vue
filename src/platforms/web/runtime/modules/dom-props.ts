import{isDef,isUndef,extend,toNumber,isTrue}from'shared/util'importtype{VNodeWithData}from'types/vnode'import{isSVG}from'web/util/index'letsvgContainerfunctionupdateDOMProps(oldVnode:VNodeWithData,vnode:VNodeWithData){if(isUndef(oldVnode.data.domProps)&&isUndef(vnode.data.domProps)){return}letkey,curconstelm:any=vnode.elmconstoldProps=oldVnode.data.domProps||{}letprops=vnode.data.domProps||{}cloneobservedobjects,astheuserprobablywantstomutateitif(isDef(props.__ob__)||isTrue(props._v_attr_proxy)){props=vnode.data.domProps=extend({},props)}for(keyinoldProps){if(!(keyinprops)){elm[key]=''}}for(keyinprops){cur=props[key]ignorechildrenifthenodehastextContentorinnerHTML,asthesewillthrowawayexistingDOMnodesandcauseremovalerrorsonsubsequentpatches(#3360)if(key==='textContent'||key==='innerHTML'){if(vnode.children)vnode.children.length=0if(cur===oldProps[key])continue#6601workaroundChromeversion<=55bugwheresingletextNodereplacedbyinnerHTML/textContentretainsitsparentNodepropertyif(elm.childNodes.length===1){elm.removeChild(elm.childNodes[0])}}if(key==='value'&&elm.tagName!=='PROGRESS'){storevalueas_valueaswellsincenon-stringvalueswillbestringifiedelm._value=curavoidresettingcursorpositionwhenvalueisthesameconststrCur=isUndef(cur)?'':String(cur)if(shouldUpdateValue(elm,strCur)){elm.value=strCur}}elseif(key==='innerHTML'&&isSVG(elm.tagName)&&isUndef(elm.innerHTML)){IEdoesn'tsupportinnerHTMLforSVGelementssvgContainer=svgContainer||document.createElement('div')svgContainer.innerHTML=`<svg>${cur}</svg>`constsvg=svgContainer.firstChildwhile(elm.firstChild){elm.removeChild(elm.firstChild)}while(svg.firstChild){elm.appendChild(svg.firstChild)}}elseif(skiptheupdateifoldandnewVDOMstateisthesame.`value`ishandledseparatelybecausetheDOMvaluemaybetemporarilyoutofsyncwithVDOMstateduetofocus,compositionandmodifiers.This#4521byskippingtheunnecessary`checked`update.cur!==oldProps[key]){somepropertyupdatescanthrowe.g.`value`on<progress>w/non-finitevaluetry{elm[key]=cur}catch(e:any){}}}}checkplatforms/web/util/attrs.jsacceptValuetypeacceptValueElm=HTMLInputElement|HTMLSelectElement|HTMLOptionElementfunctionshouldUpdateValue(elm:acceptValueElm,checkVal:string):boolean{return(@ts-expect-error!elm.composing&&(elm.tagName==='OPTION'||isNotInFocusAndDirty(elm,checkVal)||isDirtyWithModifiers(elm,checkVal)))}functionisNotInFocusAndDirty(elm:acceptValueElm,checkVal:string):boolean{returntruewhentextbox(.numberand.trim)losesfocusanditsvalueisnotequaltotheupdatedvalueletnotInFocus=true#6157workaroundIEbugwhenaccessingdocument.activeElementinaniframetry{notInFocus=document.activeElement!==elm}catch(e:any){}returnnotInFocus&&elm.value!==checkVal}functionisDirtyWithModifiers(elm:any,newVal:string):boolean{constvalue=elm.valueconstmodifiers=elm._vModifiersinjectedbyv-modelruntimeif(isDef(modifiers)){if(modifiers.number){returntoNumber(value)!==toNumber(newVal)}if(modifiers.trim){returnvalue.trim()!==newVal.trim()}}returnvalue!==newVal}exportdefault{create:updateDOMProps,update:updateDOMProps}