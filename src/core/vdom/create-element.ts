importconfigfrom'../config'importVNode,{createEmptyVNode}from'./vnode'import{createComponent}from'./create-component'import{traverse}from'../observer/traverse'import{warn,isDef,isUndef,isArray,isTrue,isObject,isPrimitive,resolveAsset,isFunction}from'../util/index'import{normalizeChildren,simpleNormalizeChildren}from'./helpers/index'importtype{Component}from'types/component'importtype{VNodeData}from'types/vnode'constSIMPLE_NORMALIZE=1constALWAYS_NORMALIZE=2//wrapperfunctionforprovidingamoreflexibleinterface//withoutgettingyelledatbyflowexportfunctioncreateElement(context:Component,tag:any,data:any,children:any,normalizationType:any,alwaysNormalize:boolean):VNode|Array<VNode>{if(isArray(data)||isPrimitive(data)){normalizationType=childrenchildren=datadata=undefined}if(isTrue(alwaysNormalize)){normalizationType=ALWAYS_NORMALIZE}return_createElement(context,tag,data,children,normalizationType)}exportfunction_createElement(context:Component,tag?:string|Component|Function|Object,data?:VNodeData,children?:any,normalizationType?:number):VNode|Array<VNode>{if(isDef(data)&&isDef((dataasany).__ob__)){__DEV__&&warn(`Avoidusingobserveddataobjectasvnodedata:${JSON.stringify(data)}\n`+'Alwayscreatefreshvnodedataobjectsineachrender!',context)returncreateEmptyVNode()}//objectsyntaxinv-bindif(isDef(data)&&isDef(data.is)){tag=data.is}if(!tag){//incaseofcomponent:issettofalsyvaluereturncreateEmptyVNode()}//warnagainstnon-primitivekeyif(__DEV__&&isDef(data)&&isDef(data.key)&&!isPrimitive(data.key)){warn('Avoidusingnon-primitivevalueaskey,'+'usestring/numbervalueinstead.',context)}//supportsinglefunctionchildrenasdefaultscopedslotif(isArray(children)&&isFunction(children[0])){data=data||{}data.scopedSlots={default:children[0]}children.length=0}if(normalizationType===ALWAYS_NORMALIZE){children=normalizeChildren(children)}elseif(normalizationType===SIMPLE_NORMALIZE){children=simpleNormalizeChildren(children)}letvnode,nsif(typeoftag==='string'){letCtorns=(context.$vnode&&context.$vnode.ns)||config.getTagNamespace(tag)if(config.isReservedTag(tag)){//platformbuilt-inelementsif(__DEV__&&isDef(data)&&isDef(data.nativeOn)&&data.tag!=='component'){warn(`The.nativemodifierforv-onisonlyvalidoncomponentsbutitwasusedon<${tag}>.`,context)}vnode=newVNode(config.parsePlatformTagName(tag),data,children,undefined,undefined,context)}elseif((!data||!data.pre)&&isDef((Ctor=resolveAsset(context.$options,'components',tag)))){//componentvnode=createComponent(Ctor,data,context,children,tag)}else{//unknownorunlistednamespacedelements//checkatruntimebecauseitmaygetassignedanamespacewhenits//parentnormalizeschildrenvnode=newVNode(tag,data,children,undefined,undefined,context)}}else{//directcomponentoptions/constructorvnode=createComponent(tagasany,data,context,children)}if(isArray(vnode)){returnvnode}elseif(isDef(vnode)){if(isDef(ns))applyNS(vnode,ns)if(isDef(data))registerDeepBindings(data)returnvnode}else{returncreateEmptyVNode()}}functionapplyNS(vnode,ns,force?:boolean){vnode.ns=nsif(vnode.tag==='foreignObject'){//usedefaultnamespaceinsideforeignObjectns=undefinedforce=true}if(isDef(vnode.children)){for(leti=0,l=vnode.children.length;i<l;i++){constchild=vnode.children[i]if(isDef(child.tag)&&(isUndef(child.ns)||(isTrue(force)&&child.tag!=='svg'))){applyNS(child,ns,force)}}}}//ref#5318//necessarytoensureparentre-renderwhendeepbindingslike:styleand//:classareusedonslotnodesfunctionregisterDeepBindings(data){if(isObject(data.style)){traverse(data.style)}if(isObject(data.class)){traverse(data.class)}}