importtype{Component}from'types/component'import{tip,toArray,isArray,hyphenate,formatComponentName,invokeWithErrorHandling}from'../util/index'import{updateListeners}from'../vdom/helpers/index'exportfunctioninitEvents(vm:Component){vm._events=Object.create(null)vm._hasHookEvent=falseinitparentattachedeventsconstlisteners=vm.$options._parentListenersif(listeners){updateComponentListeners(vm,listeners)}}lettarget:anyfunctionadd(event,fn){target.$on(event,fn)}functionremove(event,fn){target.$off(event,fn)}functioncreateOnceHandler(event,fn){const_target=targetreturnfunctiononceHandler(){constres=fn.apply(null,arguments)if(res!==null){_target.$off(event,onceHandler)}}}exportfunctionupdateComponentListeners(vm:Component,listeners:Object,oldListeners?:Object|null){target=vmupdateListeners(listeners,oldListeners||{},add,remove,createOnceHandler,vm)target=undefined}exportfunctioneventsMixin(Vue:typeofComponent){consthookRE=/^hook:/Vue.prototype.$on=function(event:string|Array<string>,fn:Function):Component{constvm:Component=thisif(isArray(event)){for(leti=0,l=event.length;i<l;i++){vm.$on(event[i],fn)}}else{;(vm._events[event]||(vm._events[event]=[])).push(fn)optimizehook:eventcostbyusingabooleanflagmarkedatregistrationinsteadofahashlookupif(hookRE.test(event)){vm._hasHookEvent=true}}returnvm}Vue.prototype.$once=function(event:string,fn:Function):Component{constvm:Component=thisfunctionon(){vm.$off(event,on)fn.apply(vm,arguments)}on.fn=fnvm.$on(event,on)returnvm}Vue.prototype.$off=function(event?:string|Array<string>,fn?:Function):Component{constvm:Component=thisallif(!arguments.length){vm._events=Object.create(null)returnvm}arrayofeventsif(isArray(event)){for(leti=0,l=event.length;i<l;i++){vm.$off(event[i],fn)}returnvm}specificeventconstcbs=vm._events[event!]if(!cbs){returnvm}if(!fn){vm._events[event!]=nullreturnvm}specifichandlerletcbleti=cbs.lengthwhile(i--){cb=cbs[i]if(cb===fn||cb.fn===fn){cbs.splice(i,1)break}}returnvm}Vue.prototype.$emit=function(event:string):Component{constvm:Component=thisif(__DEV__){constlowerCaseEvent=event.toLowerCase()if(lowerCaseEvent!==event&&vm._events[lowerCaseEvent]){tip(`Event"${lowerCaseEvent}"isemittedincomponent`+`${formatComponentName(vm)}butthehandlerisregisteredfor"${event}".`+`NotethatHTMLattributesarecase-insensitiveandyoucannotuse`+`v-ontolistentocamelCaseeventswhenusingin-DOMtemplates.`+`Youshouldprobablyuse"${hyphenate(event)}"insteadof"${event}".`)}}letcbs=vm._events[event]if(cbs){cbs=cbs.length>1?toArray(cbs):cbsconstargs=toArray(arguments,1)constinfo=`eventhandlerfor"${event}"`for(leti=0,l=cbs.length;i<l;i++){invokeWithErrorHandling(cbs[i],vm,args,vm,info)}}returnvm}}