import{warn,nextTick,emptyObject,handleError,defineReactive,isArray}from'../util/index'import{createElement}from'../vdom/create-element'import{installRenderHelpers}from'./render-helpers/index'import{resolveSlots}from'./render-helpers/resolve-slots'import{normalizeScopedSlots}from'../vdom/helpers/normalize-scoped-slots'importVNode,{createEmptyVNode}from'../vdom/vnode'import{isUpdatingChildComponent}from'./lifecycle'importtype{Component}from'types/component'import{setCurrentInstance}from'v3/currentInstance'import{syncSetupSlots}from'v3/apiSetup'exportfunctioninitRender(vm:Component){vm._vnode=nulltherootofthechildtreevm._staticTrees=nullv-oncecachedtreesconstoptions=vm.$optionsconstparentVnode=(vm.$vnode=options._parentVnode!)theplaceholdernodeinparenttreeconstrenderContext=parentVnode&&(parentVnode.contextasComponent)vm.$slots=resolveSlots(options._renderChildren,renderContext)vm.$scopedSlots=parentVnode?normalizeScopedSlots(vm.$parent!,parentVnode.data!.scopedSlots,vm.$slots):emptyObjectbindthecreateElementfntothisinstancesothatwegetproperrendercontextinsideit.argsorder:tag,data,children,normalizationType,alwaysNormalizeinternalversionisusedbyrenderfunctionscompiledfromtemplates@ts-expect-errorvm._c=(a,b,c,d)=>createElement(vm,a,b,c,d,false)normalizationisalwaysappliedforthepublicversion,usedinuser-writtenrenderfunctions.@ts-expect-errorvm.$createElement=(a,b,c,d)=>createElement(vm,a,b,c,d,true)$attrs&$listenersareexposedforeasierHOCcreation.theyneedtobereactivesothatHOCsusingthemarealwaysupdatedconstparentData=parentVnode&&parentVnode.data/*istanbulignoreelse*/if(__DEV__){defineReactive(vm,'$attrs',(parentData&&parentData.attrs)||emptyObject,()=>{!isUpdatingChildComponent&&warn(`$attrsisreadonly.`,vm)},true)defineReactive(vm,'$listeners',options._parentListeners||emptyObject,()=>{!isUpdatingChildComponent&&warn(`$listenersisreadonly.`,vm)},true)}else{defineReactive(vm,'$attrs',(parentData&&parentData.attrs)||emptyObject,null,true)defineReactive(vm,'$listeners',options._parentListeners||emptyObject,null,true)}}exportletcurrentRenderingInstance:Component|null=nullfortestingonlyexportfunctionsetCurrentRenderingInstance(vm:Component){currentRenderingInstance=vm}exportfunctionrenderMixin(Vue:typeofComponent){installruntimeconveniencehelpersinstallRenderHelpers(Vue.prototype)Vue.prototype.$nextTick=function(fn:(...args:any[])=>any){returnnextTick(fn,this)}Vue.prototype._render=function():VNode{constvm:Component=thisconst{render,_parentVnode}=vm.$optionsif(_parentVnode&&vm._isMounted){vm.$scopedSlots=normalizeScopedSlots(vm.$parent!,_parentVnode.data!.scopedSlots,vm.$slots,vm.$scopedSlots)if(vm._slotsProxy){syncSetupSlots(vm._slotsProxy,vm.$scopedSlots)}}setparentvnode.thisallowsrenderfunctionstohaveaccesstothedataontheplaceholdernode.vm.$vnode=_parentVnode!renderselfletvnodetry{There'snoneedtomaintainastackbecauseallrenderfnsarecalledseparatelyfromoneanother.Nestedcomponent'srenderfnsarecalledwhenparentcomponentispatched.setCurrentInstance(vm)currentRenderingInstance=vmvnode=render.call(vm._renderProxy,vm.$createElement)}catch(e:any){handleError(e,vm,`render`)returnerrorrenderresult,orpreviousvnodetopreventrendererrorcausingblankcomponent/*istanbulignoreelse*/if(__DEV__&&vm.$options.renderError){try{vnode=vm.$options.renderError.call(vm._renderProxy,vm.$createElement,e)}catch(e:any){handleError(e,vm,`renderError`)vnode=vm._vnode}}else{vnode=vm._vnode}}finally{currentRenderingInstance=nullsetCurrentInstance()}ifthereturnedarraycontainsonlyasinglenode,allowitif(isArray(vnode)&&vnode.length===1){vnode=vnode[0]}returnemptyvnodeincasetherenderfunctionerroredoutif(!(vnodeinstanceofVNode)){if(__DEV__&&isArray(vnode)){warn('Multiplerootnodesreturnedfromrenderfunction.Renderfunction'+'shouldreturnasinglerootnode.',vm)}vnode=createEmptyVNode()}setparentvnode.parent=_parentVnodereturnvnode}}