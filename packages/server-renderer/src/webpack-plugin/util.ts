const{red,yellow}=require('chalk')constwebpack=require('webpack')constprefix=`[vue-server-renderer-webpack-plugin]`constwarn=(exports.warn=msg=>console.error(red(`${prefix}${msg}\n`)))consttip=(exports.tip=msg=>console.log(yellow(`${prefix}${msg}\n`)))constisWebpack5=!!(webpack.version&&webpack.version[0]>4)exportconstvalidate=compiler=>{if(compiler.options.target!=='node'){warn('webpackconfig`target`shouldbe"node".')}if(compiler.options.output){if(compiler.options.output.library){Webpack>=5.0.0if(compiler.options.output.library.type!=='commonjs2'){warn('webpackconfig`output.library.type`shouldbe"commonjs2".')}}elseif(compiler.options.output.libraryTarget!=='commonjs2'){Webpack<5.0.0warn('webpackconfig`output.libraryTarget`shouldbe"commonjs2".')}}if(!compiler.options.externals){tip('Itisrecommendedtoexternalizedependenciesintheserverbuildfor'+'betterbuildperformance.')}}exportconstonEmit=(compiler,name,stageName,hook)=>{if(isWebpack5){Webpack>=5.0.0compiler.hooks.compilation.tap(name,compilation=>{if(compilation.compiler!==compiler){Ignorechildcompilersreturn}conststage=webpack.Compilation[stageName]compilation.hooks.processAssets.tapAsync({name,stage},(assets,cb)=>{hook(compilation,cb)})})}elseif(compiler.hooks){Webpack>=4.0.0compiler.hooks.emit.tapAsync(name,hook)}else{Webpack<4.0.0compiler.plugin('emit',hook)}}exportconststripModuleIdHash=id=>{if(isWebpack5){Webpack>=5.0.0returnid.replace(/\|\w+$/,'')}Webpack<5.0.0returnid.replace(/\s\w+$/,'')}exportconstgetAssetName=asset=>{if(typeofasset==='string'){returnasset}returnasset.name}export{isJS,isCSS}from'../util'