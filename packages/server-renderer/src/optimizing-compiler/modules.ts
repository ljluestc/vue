import{RAW,INTERPOLATION,EXPRESSION}from'./codegen'import{propsToAttrMap,isRenderableAttr}from'../util'import{isBooleanAttr,isEnumeratedAttr}from'web/util/attrs'importtype{StringSegment}from'./codegen'importtype{CodegenState}from'compiler/codegen/index'import{ASTAttr,ASTElement}from'types/compiler'constplainStringRE=/^"(?:[^"\\]|\\.)*"$|^'(?:[^'\\]|\\.)*'$/letthemodelASTtransformtranslatev-modelintoappropriatepropsbindingsexportfunctionapplyModelTransform(el:ASTElement,state:CodegenState){if(el.directives){for(leti=0;i<el.directives.length;i++){constdir=el.directives[i]if(dir.name==='model'){state.directives.model(el,dir,state.warn)removevaluefortextareaasitsconvertedtotextif(el.tag==='textarea'&&el.props){el.props=el.props.filter(p=>p.name!=='value')}break}}}}exportfunctiongenAttrSegments(attrs:Array<ASTAttr>):Array<StringSegment>{returnattrs.map(({name,value})=>genAttrSegment(name,value))}exportfunctiongenDOMPropSegments(props:Array<ASTAttr>,attrs:Array<ASTAttr>|null|undefined):Array<StringSegment>{constsegments:StringSegment[]=[]props.forEach(({name,value})=>{name=propsToAttrMap[name]||name.toLowerCase()if(isRenderableAttr(name)&&!(attrs&&attrs.some(a=>a.name===name))){segments.push(genAttrSegment(name,value))}})returnsegments}functiongenAttrSegment(name:string,value:string):StringSegment{if(plainStringRE.test(value)){forcedoublequotevalue=value.replace(/^'|'$/g,'"')forceenumeratedattrto"true"if(isEnumeratedAttr(name)&&value!==`"false"`){value=`"true"`}return{type:RAW,value:isBooleanAttr(name)?`${name}="${name}"`:value==='""'?`${name}`:`${name}="${JSON.parse(value)}"`}}else{return{type:EXPRESSION,value:`_ssrAttr(${JSON.stringify(name)},${value})`}}}exportfunctiongenClassSegments(staticClass:string|null|undefined,classBinding:string|null|undefined):Array<StringSegment>{if(staticClass&&!classBinding){return[{type:RAW,value:`class="${JSON.parse(staticClass)}"`}]}else{return[{type:EXPRESSION,value:`_ssrClass(${staticClass||'null'},${classBinding||'null'})`}]}}exportfunctiongenStyleSegments(staticStyle:string|null|undefined,parsedStaticStyle:string|null|undefined,styleBinding:string|null|undefined,vShowExpression:string|null|undefined):Array<StringSegment>{if(staticStyle&&!styleBinding&&!vShowExpression){return[{type:RAW,value:`style=${JSON.stringify(staticStyle)}`}]}else{return[{type:EXPRESSION,value:`_ssrStyle(${parsedStaticStyle||'null'},${styleBinding||'null'},${vShowExpression?`{display:(${vShowExpression})?'':'none'}`:'null'})`}]}}