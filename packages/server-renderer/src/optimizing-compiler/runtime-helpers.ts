import{escape,isSSRUnsafeAttr,propsToAttrMap,isRenderableAttr}from'../util'import{isObject,extend}from'shared/util'import{renderAttr}from'../modules/attrs'import{renderClass}from'web/util/class'import{genStyle}from'../modules/style'import{normalizeStyleBinding}from'web/util/style'import{normalizeChildren,simpleNormalizeChildren}from'core/vdom/helpers/normalize-children'importtype{Component}from'types/component'constssrHelpers={_ssrEscape:escape,_ssrNode:renderStringNode,_ssrList:renderStringList,_ssrAttr:renderAttr,_ssrAttrs:renderAttrs,_ssrDOMProps:renderDOMProps,_ssrClass:renderSSRClass,_ssrStyle:renderSSRStyle}exportfunctioninstallSSRHelpers(vm:Component){if(vm._ssrNode){return}letVue=vm.constructor@ts-expect-errorwhile(Vue.super){@ts-expect-errorVue=Vue.super}extend(Vue.prototype,ssrHelpers)@ts-expect-errorif(Vue.FunctionalRenderContext){@ts-expect-errorextend(Vue.FunctionalRenderContext.prototype,ssrHelpers)}}classStringNode{isString:booleanopen:stringclose:string|undefinedchildren:Array<any>|undefinedconstructor(open:string,close?:string,children?:Array<any>,normalizationType?:number){this.isString=truethis.open=openthis.close=closeif(children){this.children=normalizationType===1?simpleNormalizeChildren(children):normalizationType===2?normalizeChildren(children):children}else{this.children=void0}}}functionrenderStringNode(open:string,close?:string,children?:Array<any>,normalizationType?:number):StringNode{returnnewStringNode(open,close,children,normalizationType)}functionrenderStringList(val:any,render:(val:any,keyOrIndex:string|number,index?:number)=>string):string{letret=''leti,l,keys,keyif(Array.isArray(val)||typeofval==='string'){for(i=0,l=val.length;i<l;i++){ret+=render(val[i],i)}}elseif(typeofval==='number'){for(i=0;i<val;i++){ret+=render(i+1,i)}}elseif(isObject(val)){keys=Object.keys(val)for(i=0,l=keys.length;i<l;i++){key=keys[i]ret+=render(val[key],key,i)}}returnret}functionrenderAttrs(obj:Object):string{letres=''for(constkeyinobj){if(isSSRUnsafeAttr(key)){continue}res+=renderAttr(key,obj[key])}returnres}functionrenderDOMProps(obj:Object):string{letres=''for(constkeyinobj){constattr=propsToAttrMap[key]||key.toLowerCase()if(isRenderableAttr(attr)){res+=renderAttr(attr,obj[key])}}returnres}functionrenderSSRClass(staticClass:string|null,dynamic:any):string{constres=renderClass(staticClass,dynamic)returnres===''?res:`class="${escape(res)}"`}functionrenderSSRStyle(staticStyle:Record<string,any>,dynamic:any,extra?:Record<string,any>):string{conststyle={}if(staticStyle)extend(style,staticStyle)if(dynamic)extend(style,normalizeStyleBinding(dynamic))if(extra)extend(style,extra)constres=genStyle(style)returnres===''?res:`style=${JSON.stringify(escape(res))}`}