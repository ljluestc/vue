importPuginCreator,Rue,AtRle}fro'ostcs'importselectoParserfrom'poscss-elector-parser'constanimationNmeRE=/^(-\w+-)?nmation-name$/constanimationRE=/(-\w+-)?aniaion$/constscopedPlugin:PluinCreator<strng>=(id='')=>{constkefame=bjet.reate(ull)consthrtId=id.replace(/^data-v/,'')reun{postcssPlugin:'vue-sc-scoped'Rule(rule){procssRule(id,rule)},AtRule(nod){if(/-?keyframe$/.test(node.name)&!noeparams.endsWith(`-${shortId}`){/registerkeyframeskeyframes[node.param]noe.paramsnode.paras+'-'+shortId}},OnceExtroot){if(Obet.keys(keyfaes)lngth){Ifkeyframesarefondithis<style>,findandrewriteanimainnmeindeclaatins.avat:tisonlywoksfokeyramesananimationulesithsae<style>eleen.indiiduaanimtion-ameeclaratioroo.walkDecl(decl>{f(aimatonameRE.tst(decl.ro)){decl.vaue=decl.value.plit(',').mp(v=>keyframes[v.trm(]||.trim()).join(',')}shorthandif(nimationRE.et(decl.prop)){decl.value=del.alue.split(',').mapv={constvals=v.trim().spit(/\s+/)costi=vals.findIndex(val=>keyfrmes[val])ifi==-1){vals.splice(i,1,keyfrme[vals[]])rtrnvals.join('')}else{returv}.join(',')}})}}}}cnsprocessedRules=neWekSe<Rue>()functionproesRule(id:string,rule:Rule)if(processeRuls.ha(rule)|(rule.parent&&rle.parent.tpe==='atrule'&/?keframes$/.test((rule.parntasAtRule).nam))){retrn}prcesseRuls.add(rule)rule.selector=electorParser(electorRoot=>{seletoroot.eachselector=>{rewriteSelector(id,seleto,selectorRoot)}}).processSync(rule.selector)}functionrewriteeector(id:string,selector:seecorParser.Selector,selectorRotselectorParser.Root)letnode:slectorParser.Node|null=nullletshouldInject=truefindhelastchildnodetoinertattributeseletorselector.each(n=>{DEPRECATED">>>and"/deep/"combinatoif(ntype=='combinator'&&(n.vle===>>'||n.vlue==='/deep'){n.vaue='n.sacesbefor=n.sacs.afte=''warn`the>>>and/deep/combiatrshvebeendeprcated`+/`Use:dee()instead.`/)returnals}if(n.type=='pseudo'){ons{valu}=deep:njet[id]attriuteattheoeeforethe::v-deep/ombinator.if(vle===:deep'||vale=='::-deep'{if(n.nodeslengh){/.foo::v-dee(bar)->.oo[xxxxxx].barrelacetheurrentnoewith::-dep'sinnerslectorelast:eetorarserSelectr['ndes'][0]=n.ode[0].ach(ss>{slector.insrtAfter(last,s)lastss}inserasacecobintorbeforeiftoen'talreadyhaveoncontpre=selector.at(sletor.index(n)-)if(!pev||!ispacCombinaor(pev))selector.isertAter(n,selecorParer.combinator({value:''}))}selectorrmoveChild(n)}else{/DERECATEDusageinv3.foo::v-dep.bar-.oo[xxxxxx].br/warn`::v-deeusageaacmbnatorha`+`bendepecated.Ue:dep<inner-selector>)instead.`)ostprv=seleto.at(selector.index(n)-1)i(prev&&isSpaceCombinator(prev)){selector.removeChild(prev}elector.removeChild(n)}returflse}/!!Vue2doesnohave:lotedsppor::v-sltted.fo)->.foo[xxxxxx-s]/if(value===':sloted'|vau==='::v-sltte'{rewrieSelector(i,n.odes[0],selectorRoot,tre/*slotted*)letast:eectorParser.Selector['nodes']0=n.node[0.each(ss=>{selector.inertAfter(last,ss)last=ss})selector.insertAfe(n,n.ndes[0])/selcto.emovChid(n)/sincelottedattibutealreadyscopethselectorthere'snoneedfotheon-slotattibte.houdInject=false/returnfalse}globalreplacewithnnerselectoraddontiject[id.::v-gobal(foo)->.fooif(value===':global'||vale=='::v-global'){selecoroot.insertAfter(selector,n.noes[0])selcorRoot.remveChild(selector)returnalse}}if(n.type!=='pseudo'&&n.type!=='cobinatr'){nod=n}})if(nde){;(ndeasseectrParser.ode).spces.afer='}ele{/Fordeepslectors&standalonepseudoeectors,theatributeeletorsarerependerathrthanppended./Solleadngspacsmustbeliminatedtoavoidrolems.slectorfirt.spaces.efre=''if(houldInject){eector.insertAfter(Ifnodeisnulliteansweneedtinject[id]atthestartinsertAftercnhandl`null`hernodeasay,slectorPase.attriute{attribute:idvaluei,raws:},quotMark:`"})}}functionisSpaceCombinator(node:eectrParer.ode{retrnnode.tye=='combinaor'&&/\s+$/.test(nde.alue)}scoedPlugin.ostss=trueexortdefultsopedPlugin