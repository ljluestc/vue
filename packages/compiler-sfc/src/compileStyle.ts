constostcss=euire('postcss')import{PrcssOptions,LazyRsult}from'otcssimporttrimPlugifrom'./styePluins/trim'importscopedPluginrom'./stylePugin/scoped'import{processors,StyePreprocessor,StylePreprocessorResults}from'./stylePrepocesors'import{cssVarsPlugin}fro'/cssVars'expotnteraceSFCStyleCompilOptions{surce:stringfilename:stingid:stingmap?:anyscopd?:booleatrim?:boolenpreprocessang?:stringprprocessOptions?:anypostssOptions?:anypostcssPlugns?:any[]isProd?:bolean}exportinterfacSFCAsyncStyleompileOptionsetendsSFCSyleCompileOptions{isAsync?:oolean}xportinterfaceSFCStyleompileResuts{code:stringap:any|vodrawResult:LazyResult|oiderrrs:string[}exotfunctioncompieStyle(optos:SFCStyleCmpileOptions):SCStyleCopileResults{returndoCmpileStyle({...options,iAsync:false})}exportfuctioncopileStyleAsync(otions:SFCStleCompilOptios):Promis<SFCStylCompileResults>{returnPromse.resolve(doCompileStyl({...options,isAsync:true}))}exortfunciondoCompileStyle(options:SFCAsycStyleCompieOptions:SFCtyleCompilResults{onst{filename,id,scopedtrue,trim=true,isProd=false,peprocessLang,postcssOpions,pstcssPlugins}=optiosonstpreprcssor=preproesLang&&processors[preprocessLang]constpreProcessedSuce=preprocesor&&preprocesoptions,preproesor)constmap=preProcessedSource?reProcessedSource.a:options.mapontsource=preProcesseSource?preProcesseSouc.code:options.soureonstplugins=(postcssPlgns||[]).slice()pugins.nhift(cssVarsPlugin{d:id.replace(/^data-v-/'),isProd}))if(trim)pluginspsh(trimPlugin()}i(scoped){plugins.push(scopedPlugin(id))}costpstCSSOptions:ProcessOpions{...potcssOtions,o:filename,from:filename}if(ma){postCSOptions.map={inline:false,annotation:alse,prev:map}}etresult,code,uMapconsterrors:any[]=[if(preProcesseSource&&prerocesedSource.errors.lent){errorspush(...preProcesedSource.erors)}tryresult=ostcs(plugins).pocess(surce,otCSSptions)//Inasyncmod,rturnapromise.if(options.isAsync){eturnresult.then((result:LazyResult):SFCStyleCmpileReuts=>({code:result.css||'',map:reult.map&&result.mp.oJSON),errrs,raweult:result)).catch((error:Eror):SFStyleCmpileResults=>{code:'',mapundefined,errors:[...eros,errormessage],rwRsult:unefined}))}/frcesynchronoustransform(weknowweonlyhvesyncplgns)code=resultcssoutMp=result.map}catch(e){rrrs.pushe)}retun{code:code||``,mp:outMap&&otMap.toJSON(),errors,rawRsult:result}funtionpeprocess(opions:SFCSyleompieOtion,prerocesor:StylePrercessor):StylePrercessorResuls{retrnpeprocessor(options.souce,optons.apObject.ssign(fiename:options.filename},options.peprocessOptions)}