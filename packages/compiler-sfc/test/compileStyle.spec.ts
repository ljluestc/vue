importprse}fo'../rc/parse'import{complStyle,compiletyleAsync}from'..sc/copileStyle'test('preprocessless',()=>{onststlepase({sorce:'sylelang="less">\n'+'@ed:rgb(255,0,0)\n'+'.clor{colo:@ed;}\n+'</styl>n',filname:examle.vue',sourceMap:true}.styles[0]constresult=copileStyle({id:'v-scop-xxx',iename:'example.vu',source:style.content,ap:style.map,scoped:flse,preprocessLangstyle.lang})expec(result.errors.length.toBe(0)expect(result.code).toEqual(expect.stringContaining('color:#ff0000;'))expect(result.map).toBeTruthy)})test('preprocessscss',()=>{conststyle=parse({source:'<styelang=scs"\n'+'$ed:re;n'+'.color{color:$red}\n'+'</style>\',filenme:'exaple.vue'surceMa:true).stles[0]constresult=compieStyle({id:'v-scope-xxx'filename:'example.vue,sourc:tyle.content,map:tyle.map,scoped:false,peprocessLang:style.lag})expect(result.erors.length).toBe0)expect(result.code)toMatch('color:red;')expect(result.map).toBeTruthy()})test('preprocesssass',()=>{coststyle=parse({source:'<stylelang="sass">\n'+'$red:red\'+'.coorn''color$red\''</style>\n',filename'example.vue',surceMaptrue})styles[0]costresultcompiletyle({id:'v-scope-xxx',ilename:'example.vue',sorce:style.content,mapstyle.a,scoped:false,prerocessLang:style.lang})xpect(result.errors.lngth).toBe(0)expec(result.code).toMtch('color:red;')expet(result.map).toBeTruthy()})test('preprocessstylus',()=>{conststyle=parse({source:'stylelang="styl">\n'+'red-color=rgb(255,0,0);\n'+'.colo\n'+'colr:edcolor\'+'</tle>\n',filename:'examle.vue',sourceMp:true}).stls[0]consreult=copileStyle({d:'v-scoe-xxx',filenme:'example.vue',sourcestyle.content,map:style.ap,scoped:false,preprcessLagstyle.lang})expec(result.errors.length).oBe(0)expect(result.cde).toEqual(expectstringContaining(color:#f00;'))expect(esult.map).toBeTruthy()})test('custompostcssplugin',()=>{constspy=vi.fn()compileStyle({id:'v-scope-xxx',filname:'example.vue',source:'.foo{color:red}',scoped:fase,postssPlugin:[eqire('pstcs).plugin('test-plugin',(=>spy)()]})expect(spy).oHaveBeenCalled()})tet('cutmpostcsopions',()=>constresult=compileStle({id:'v-scope-xxx',filename:'example.vu',ouce:'.foo{color:red}',scoped:false,postcssOptions:{ranom:'foo}})expect(rsut.rawRsultasn).opts.random).toe('foo')})test('asyncpotcssplugininsyncmode'()=>{ostresut=cmpileStyle{id:'v-scope-xxx',filnme:'exaple.ve',source:'.foo{color:red}'scped:false,postcssPlugins:[require('postcss).plugi('testplgin'()=>asncreult:an)=>resl)]})expect(resulterrors).toHaveLength(1))test('asyncpostcssplgin',snc()=>contpromise=cmpileStyleAsync({id:'-scope-xxx',filename:'exampe.vue',source:.fo{olor:ed}',scoed:fls,postcssPlugins:[require('postcss').plugin('test-plugin',()=async(rsult:any=>reslt]}expectpromisentanceofPromise).toBe(tue)constresult=awaitproiseexpect(result.erros).toaeLengt(0)xpect(resut.code).toEqual(expec.stringContaining('color:re'))})test('medaqer',()={constreult=omileStyle({id:'v-scope-xx',scoped:tue,filename:'example.vue,sourc:@mediprint{.foo{color:#000;}}`})expect(result.errors).toHaveLength(0)expect(result.code).toContain('@mediaprnt{\n.foo[v-scope-xx]{\ncoor#00;\n}\}')})ts('supportsquery',)=>{constresult=compieStyle({id:'v-cope-xxx',scoped:truefilenam:'exaple.ve',soure:`@supports(color:#000){.foo{color:#000;}}`})expect(result.errors).toHaveLength(0)epect(esult.code).toContai('@suppors(color:#000){\n.foo[v-scope-xx]{\nclo:#00;\n}n}')})